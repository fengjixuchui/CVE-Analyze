import email
from idna import valid_contextj
import xlrd  
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
import time
from selenium.webdriver.support.ui import Select



def Add_new_worker(driver,worker,sn_index):
    driver.find_element(by=By.TAG_NAME,value="button").click()
    time.sleep(2)
    driver.switch_to.default_content()
    iframe = driver.find_elements(by=By.TAG_NAME,value="iframe")[1]

    driver.switch_to.frame(iframe)

    driver.find_element(by=By.ID,value="name").send_keys(worker["name"])
    driver.find_element(by=By.ID,value="cardNumber").send_keys(worker["id"])
    # driver.find_element(by=By.TAG_NAME,value="button").click()
    # time.sleep(5)
    driver.find_element(by=By.ID,value="birthday").send_keys(worker["year"]+"-"+worker["month"]+"-"+worker["day"])
    Org = Select(driver.find_element(by=By.ID,value='unitId')) 
    Org.select_by_visible_text(worker["org"])
    # s_index=-1
    # for index,item in enumerate(driver.find_element(by=By.ID,value='unitId').find_elements(by=By.TAG_NAME,value="option")):
    #     if item.text==worker["org"]:
    #         s_index=index
    # Org.select_by_index(s_index)  # 选择第二项选项：o1
    # print(s_index)
    driver.find_element(by=By.ID,value="unitAcademy").send_keys(worker["department"])
    Select(driver.find_element(by=By.ID,value='continent')).select_by_visible_text("亚洲")
    Select(driver.find_element(by=By.ID,value='country')).select_by_visible_text("中华人民共和国")
    Select(driver.find_element(by=By.ID,value='cardType')).select_by_visible_text("身份证")
    Select(driver.find_element(by=By.ID,value='sn')).select_by_visible_text(str(sn_index).rjust(2, '0'))
    Select(driver.find_element(by=By.ID,value='sex')).select_by_visible_text(worker["sex"])
    Select(driver.find_element(by=By.ID,value='education')).select_by_visible_text(worker["education"])
    Select(driver.find_element(by=By.ID,value='degree')).select_by_visible_text(worker["degree"])

    if "正高级" in worker["position"] or worker["position"]=="教授":
        Select(driver.find_element(by=By.ID,value='title')).select_by_visible_text("正高级")
    elif "副高级" in worker["position"] or worker["position"]=="副教授":
        Select(driver.find_element(by=By.ID,value='title')).select_by_visible_text("副高级")
    elif "中级" in worker["position"] or "助理" in worker["position"] or "讲师" in  worker["position"]:
        Select(driver.find_element(by=By.ID,value='title')).select_by_visible_text("中级")
    elif "初级" in worker["position"]:
        Select(driver.find_element(by=By.ID,value='title')).select_by_visible_text("初级")
    elif "无" in worker["position"] or "其它" in worker["position"] or "其他" in worker["position"]:
        Select(driver.find_element(by=By.ID,value='title')).select_by_visible_text("其他")
    else:
        print(worker["name"]+"职称不匹配")
    

    if "是" in worker["hassalary"] or "有" in worker["hassalary"]:
        Select(driver.find_element(by=By.ID,value='sfgzxsr')).select_by_visible_text("是")
    elif  "否" in worker["hassalary"] or "无" in worker["hassalary"]:
        Select(driver.find_element(by=By.ID,value='sfgzxsr')).select_by_visible_text("否")
    else:
        print(worker["name"]+"工资收入不明确")
    
    if "骨干" in worker["persontype"]:
        Select(driver.find_element(by=By.ID,value='type')).select_by_visible_text("项目/课题骨干")
    else:
        Select(driver.find_element(by=By.ID,value='type')).select_by_visible_text("其他研究人员")

    
    Select(driver.find_element(by=By.ID,value='isStudent')).select_by_visible_text(worker["isStu"])

    driver.find_element(by=By.ID,value="duty").send_keys(worker["job"])
    driver.find_element(by=By.ID,value="major").send_keys(worker["major"])
    driver.find_element(by=By.ID,value="phone").send_keys(worker["phone"])
    driver.find_element(by=By.ID,value="mobile").send_keys(worker["mobilephone"])
    driver.find_element(by=By.ID,value="email").send_keys(worker["email"])
    driver.find_element(by=By.ID,value="manMonth").send_keys(worker["worktime"])
    driver.find_element(by=By.ID,value="tasksKt").send_keys(worker["workcontent"])

    driver.switch_to.default_content()
    driver.find_elements(by=By.CLASS_NAME,value="layui-layer-btn")[-1].find_elements(by=By.TAG_NAME,value="a")[0].click()
    time.sleep(1)
    driver.find_elements(by=By.CLASS_NAME,value="layui-layer-btn")[-1].find_elements(by=By.TAG_NAME,value="a")[0].click()
    time.sleep(1)
    driver.find_elements(by=By.CLASS_NAME,value="layui-layer-btn")[-1].find_elements(by=By.TAG_NAME,value="a")[0].click()
    time.sleep(1)
    driver.find_elements(by=By.CLASS_NAME,value="layui-layer-btn")[-1].find_elements(by=By.TAG_NAME,value="a")[0].click()
    time.sleep(2)


    
    
    
    



chrome_options = Options()
chrome_options.add_experimental_option("debuggerAddress", "127.0.0.1:9222")

driver = webdriver.Chrome(chrome_options=chrome_options)
# print(driver.title)
# driver.find_element(by=By.ID,value="person").click()
driver.switch_to.frame("iframe_content")
table=driver.find_element(by=By.TAG_NAME,value="table")
trs=table.find_element(by=By.TAG_NAME,value="tbody").find_elements(by=By.TAG_NAME,value="tr")[0:-3]

Leader=trs[0]
Leader_info=Leader.find_elements(by=By.TAG_NAME,value="td")
Leader_sn=Leader_info[1].text
Leader_name=Leader_info[2].text
Leader_id=Leader_info[3].text


# ###########课题1#########
# start_sn=1
# sn_index=start_sn

# xlsx = xlrd.open_workbook('D:\\William\\程序喵们\\工程\\NJULab\\智能车课题\\人员名单\\课题一-人员清-中山更新版.xlsx')
# sheet1 = xlsx.sheets()[0]   
# sheet1_nrows = sheet1.nrows 

# for lineno in range(sheet1_nrows):
#     if lineno==0:
#         continue
#     line=sheet1.row_values(lineno)

#     worker={}
#     worker["name"]=line[1].strip()
#     worker["sex"]=line[2].strip()
#     worker["id"]=line[6].strip()
#     # birth=
#     worker["year"] = worker["id"][6:10]
#     worker["month"] =  worker["id"][10:12]
#     worker["day"] =  worker["id"][12:14]
#     worker["mobilephone"]=str(int(line[7])).strip()
#     worker["phone"]=str(line[8]).strip()
#     worker["email"]=line[9].strip()
#     worker["position"]=line[10].strip()
#     worker["job"]=line[11].strip()
#     worker["degree"]=line[12].strip()
#     worker["education"]=line[13].strip()
#     worker["major"]=line[14].strip()
#     worker["isStu"]=line[15].strip()
#     worker["worktime"]=str(int(line[16])).strip()
#     worker["persontype"]=line[17].strip()
#     worker["workcontent"]=line[19].strip()
#     worker["hassalary"]=line[20].strip()
#     worker["org"]=line[21].strip()
#     worker["department"]=line[22].strip()

#     if worker["name"]==Leader_name and worker["id"] in Leader_id:
#         continue

#     if sn_index== int(Leader_sn):
#         sn_index+=1

#     Add_new_worker(driver,worker,sn_index)

#     sn_index+=1
#     driver.switch_to.frame("iframe_content")


# ###########课题2#########
# start_sn=1
# sn_index=start_sn

# xlsx = xlrd.open_workbook('D:\\William\\程序喵们\\工程\\NJULab\\智能车课题\\人员名单\\课题二-人员名单.xlsx')
# sheet1 = xlsx.sheets()[0]   
# sheet1_nrows = sheet1.nrows 

# for lineno in range(sheet1_nrows):
#     if lineno==0:
#         continue
#     line=sheet1.row_values(lineno)

#     worker={}
#     worker["name"]=line[1].strip()
#     worker["sex"]=line[2].strip()
#     worker["id"]=line[6].strip()
#     # birth=
#     worker["year"] = worker["id"][6:10]
#     worker["month"] =  worker["id"][10:12]
#     worker["day"] =  worker["id"][12:14]
#     worker["mobilephone"]=str(int(line[7])).strip()
#     worker["phone"]=line[8].strip()
#     worker["email"]=line[9].strip()
#     worker["position"]=line[10].strip()
#     worker["job"]=line[11].strip()
#     worker["degree"]=line[12].strip()
#     worker["education"]=line[13].strip()
#     worker["major"]=line[14].strip()
#     worker["isStu"]=line[15].strip()
#     worker["worktime"]=str(int(line[16])).strip()
#     worker["persontype"]=line[17].strip()
#     worker["workcontent"]=line[19].strip()
#     worker["hassalary"]=line[20].strip()
#     worker["org"]=line[21].strip()
#     worker["department"]=line[22].strip()

#     if worker["name"]==Leader_name and worker["id"] in Leader_id:
#         continue

#     if sn_index== int(Leader_sn):
#         sn_index+=1

#     Add_new_worker(driver,worker,sn_index)

#     sn_index+=1
#     driver.switch_to.frame("iframe_content")






# #########课题3#########
# start_sn=1
# sn_index=start_sn

# xlsx = xlrd.open_workbook('D:\\William\\程序喵们\\工程\\NJULab\\智能车课题\\人员名单\\课题三-人员名单.xlsx')
# sheet1 = xlsx.sheets()[0]   
# sheet1_nrows = sheet1.nrows 

# for lineno in range(sheet1_nrows):
#     if lineno==0:
#         continue
#     line=sheet1.row_values(lineno)

#     worker={}
#     worker["name"]=line[1].strip()
#     worker["sex"]=line[2].strip()
#     worker["id"]=line[6].strip()
#     # birth=
#     worker["year"] = worker["id"][6:10]
#     worker["month"] =  worker["id"][10:12]
#     worker["day"] =  worker["id"][12:14]
#     worker["mobilephone"]=str(int(line[7])).strip()
#     worker["phone"]=str(line[8]).strip()
#     worker["email"]=line[9].strip()
#     worker["position"]=line[10].strip()
#     worker["job"]=line[11].strip()
#     worker["degree"]=line[12].strip()
#     worker["education"]=line[13].strip()
#     worker["major"]=line[14].strip()
#     worker["isStu"]=line[15].strip()
#     worker["worktime"]=str(int(line[16])).strip()
#     worker["persontype"]=line[17].strip()
#     worker["workcontent"]=line[19].strip()
#     worker["hassalary"]=line[20].strip()
#     worker["org"]=line[21].strip()
#     worker["department"]=line[22].strip()

#     if worker["name"]==Leader_name and worker["id"] in Leader_id:
#         continue

#     if sn_index== int(Leader_sn):
#         sn_index+=1

#     Add_new_worker(driver,worker,sn_index)

#     sn_index+=1
#     driver.switch_to.frame("iframe_content")








# ###########课题4#########
# start_sn=1
# sn_index=start_sn

# xlsx = xlrd.open_workbook('D:\\William\\程序喵们\\工程\\NJULab\\智能车课题\\人员名单\\课题四-人员名单.xlsx')
# sheet1 = xlsx.sheets()[0]   
# sheet1_nrows = sheet1.nrows 

# for lineno in range(sheet1_nrows):
#     if lineno==0:
#         continue
#     line=sheet1.row_values(lineno)

#     worker={}
#     worker["name"]=line[1].strip()
#     worker["sex"]=line[2].strip()
#     worker["id"]=line[6].strip()
#     # birth=
#     worker["year"] = worker["id"][6:10]
#     worker["month"] =  worker["id"][10:12]
#     worker["day"] =  worker["id"][12:14]
#     worker["mobilephone"]=str(int(line[7])).strip()
#     worker["phone"]=str(line[8]).strip()
#     worker["email"]=line[9].strip()
#     worker["position"]=line[10].strip()
#     worker["job"]=line[11].strip()
#     worker["degree"]=line[12].strip()
#     worker["education"]=line[13].strip()
#     worker["major"]=line[14].strip()
#     worker["isStu"]=line[15].strip()
#     worker["worktime"]=str(int(line[16])).strip()
#     worker["persontype"]=line[17].strip()
#     worker["workcontent"]=line[19].strip()
#     worker["hassalary"]=line[20].strip()
#     worker["org"]=line[21].strip()
#     worker["department"]=line[22].strip()

#     if worker["name"]==Leader_name and worker["id"] in Leader_id:
#         continue

#     if sn_index== int(Leader_sn):
#         sn_index+=1

#     Add_new_worker(driver,worker,sn_index)

#     sn_index+=1
#     driver.switch_to.frame("iframe_content")


# ###########课题5#########
# start_sn=1
# sn_index=start_sn

# xlsx = xlrd.open_workbook('D:\\William\\程序喵们\\工程\\NJULab\\智能车课题\\人员名单\\课题五-人员名单.xlsx')
# sheet1 = xlsx.sheets()[0]   
# sheet1_nrows = sheet1.nrows 

# for lineno in range(sheet1_nrows):
#     if lineno==0:
#         continue
#     line=sheet1.row_values(lineno)

#     worker={}
#     worker["name"]=line[1].strip()
#     worker["sex"]=line[2].strip()
#     worker["id"]=line[6].strip()
#     # birth=
#     worker["year"] = worker["id"][6:10]
#     worker["month"] =  worker["id"][10:12]
#     worker["day"] =  worker["id"][12:14]
#     worker["mobilephone"]=str(int(line[7])).strip()
#     worker["phone"]=str(line[8]).strip()
#     worker["email"]=line[9].strip()
#     worker["position"]=line[10].strip()
#     worker["job"]=line[11].strip()
#     worker["degree"]=line[12].strip()
#     worker["education"]=line[13].strip()
#     worker["major"]=line[14].strip()
#     worker["isStu"]=line[15].strip()
#     worker["worktime"]=str(int(line[16])).strip()
#     worker["persontype"]=line[17].strip()
#     worker["workcontent"]=line[19].strip()
#     worker["hassalary"]=line[20].strip()
#     worker["org"]=line[21].strip()
#     worker["department"]=line[22].strip()

#     if worker["name"]==Leader_name and worker["id"] in Leader_id:
#         continue

#     if sn_index== int(Leader_sn):
#         sn_index+=1

#     Add_new_worker(driver,worker,sn_index)

#     sn_index+=1
#     driver.switch_to.frame("iframe_content")
