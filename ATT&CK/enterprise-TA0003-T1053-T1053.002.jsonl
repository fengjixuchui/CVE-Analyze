{"TTP_id": "enterprise-TA0003-T1053-T1053.002", "TTP_name": "At", "Description": "Adversaries may abuse the at utility to perform task scheduling for initial or recurring execution of malicious code. The at utility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor of Scheduled Task's schtasks in Windows environments, using at requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group.On Linux and macOS, at may be invoked by the superuser as well as any users added to the at.allow file. If the at.allow file does not exist, the at.deny file is checked. Every username not listed in at.deny is allowed to invoke at. If the at.deny exists and is empty, global use of at is permitted. If neither file exists (which is often the baseline) only the superuser is allowed to use at.[1]Adversaries may use at to execute programs at system startup or on a scheduled basis for Persistence. at can also be abused to conduct remote Execution as part of Lateral Movement and/or to run a process under the context of a specified account (such as SYSTEM).In Linux environments, adversaries may also abuse at to break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly, at may also be used for Privilege Escalation if the binary is allowed to run as superuser via sudo.[2]", "Property": {"ID": "T1053.002", "Sub-technique of": "T1053", "Tactics": "Execution, Persistence, Privilege Escalation", "Platforms": "Linux, Windows, macOS", "Permissions Required": "Administrator, User", "Supports Remote": "Yes", "Version": "2.0", "Created": "27 November 2019", "Last Modified": "18 April 2022"}, "Examples": {"G0026": ["https://attack.mitre.org/groups/G0026", "APT18", "APT18 actors used the native at Windows task scheduler tool to use scheduled tasks for execution on a victim network.[3]"], "S0110": ["https://attack.mitre.org/software/S0110", "at", "at can be used to schedule a task on a system to be executed at a specific date or time.[4][1]"], "G0060": ["https://attack.mitre.org/groups/G0060", "BRONZE BUTLER", "BRONZE BUTLER has used at to register a scheduled task to execute malware during lateral movement.[5]"], "S0488": ["https://attack.mitre.org/software/S0488", "CrackMapExec", "CrackMapExec can set a scheduled task on the target system to execute commands remotely using at.[6]"], "S0233": ["https://attack.mitre.org/software/S0233", "MURKYTOP", "MURKYTOP has the capability to schedule remote AT jobs.[7]"], "G0027": ["https://attack.mitre.org/groups/G0027", "Threat Group-3390", "Threat Group-3390 actors use at to schedule tasks to run self-extracting RAR archives, which install HTTPBrowser or PlugX on other victims on a network.[8]"]}, "Mitigation": {"M1047": ["https://attack.mitre.org/mitigations/M1047", "Audit", "Toolkits like the PowerSploit framework contain PowerUp modules that can be used to explore systems for permission weaknesses in scheduled tasks that could be used to escalate privileges. [9] Windows operating system also creates a registry key specifically associated with the creation of a scheduled task on the destination host at: Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\At1. [10] In Linux and macOS environments, scheduled tasks using at can be audited locally, or through centrally collected logging, using syslog, or auditd events from the host. [11]"], "M1028": ["https://attack.mitre.org/mitigations/M1028", "Operating System Configuration", "Configure settings for scheduled tasks to force tasks to run under the context of the authenticated account instead of allowing them to run as SYSTEM. The associated Registry key is located at HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\SubmitControl. The setting can be configured through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > Security Options: Domain Controller: Allow server operators to schedule tasks, set to disabled. [12]"], "M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Configure the Increase Scheduling Priority option to only allow the Administrators group the rights to schedule a priority process. This can be configured through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Increase scheduling priority. [13]"], "M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "Limit privileges of user accounts and remediate Privilege Escalation vectors so only authorized administrators can create scheduled tasks on remote systems. In Linux environments, users account-level access to at can be managed using at.allow and at.deny files. Users listed in the at.allow are enabled to schedule actions using at, whereas users listed in at.deny file disabled from the utility."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments for actions that could be taken to create/modify tasks. Tasks may also be created through Windows system management tools such as Windows Management Instrumentation and PowerShell, so additional logging may need to be configured to gather the appropriate data.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Modification": ["On Windows, monitor Windows Task Scheduler stores in %systemroot%\\System32\\Tasks for change entries related to scheduled tasks, especially those that do not correlate with known software, patch cycles, etc. On Linux and macOS, all at jobs are stored in /var/spool/cron/atjobs/.[14]", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Process Creation": ["Monitor for newly constructed processes with command-lines that create/modify or are executed from tasks. For example, on Windows tasks may spawn from svchost.exe or the Windows Task Scheduler taskeng.exe for older OS versions. [15] Suspicious program execution through scheduled tasks may show up as outlier processes that have not been seen before when compared against historical data.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Scheduled Job Creation": ["Monitor for newly constructed scheduled jobs. If scheduled tasks are not used for persistence, then the adversary is likely to remove the task when the action is complete. On Windows, enable the \"Microsoft-Windows-TaskScheduler/Operational\" setting within the event logging service where several events will then be logged on scheduled task activity, including:[16]Tools such as Sysinternals Autoruns may also be used to detect system changes that could be attempts at persistence, including listing current scheduled tasks. [17]", "DS0003", "https://attack.mitre.org/datasources/DS0003", "Scheduled Job"]}}
