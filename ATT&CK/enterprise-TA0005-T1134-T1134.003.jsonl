{"TTP_id": "enterprise-TA0005-T1134-T1134.003", "TTP_name": "Make and Impersonate Token", "Description": "Adversaries may make and impersonate tokens to escalate privileges and bypass access controls. If an adversary has a username and password but the user is not logged onto the system, the adversary can then create a logon session for the user using the LogonUser function. The function will return a copy of the new session's access token and the adversary can use SetThreadToken to assign the token to a thread.", "Property": {"ID": "T1134.003", "Sub-technique of": "T1134", "Tactics": "Defense Evasion, Privilege Escalation", "Platforms": "Windows", "Permissions Required": "Administrator, User", "Effective Permissions": "SYSTEM", "Defense Bypassed": "File system access controls, System access controls, Windows User Account Control", "Version": "1.0", "Created": "18 February 2020", "Last Modified": "18 February 2020"}, "Examples": {"S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can make tokens from known credentials.[1]"]}, "Mitigation": {"M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Limit permissions so that users and user groups cannot create tokens. This setting should be defined for the local system account only. GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Create a token object. [2] Also define who can create a process level token to only the local and network service through GPO: Computer Configuration > [Policies] > Windows Settings > Security Settings > Local Policies > User Rights Assignment: Replace a process level token.[3]Administrators should log in as a standard user but run their tools with administrator privileges using the built-in access token manipulation command runas.[4]"], "M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "An adversary must already have administrator level access on the local system to make full use of this technique; be sure to restrict users and accounts to the least privileges they require."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments to detect token manipulation by auditing command-line activity. Specifically, analysts should look for use of the runas command or similar artifacts. Detailed command-line logging is not enabled by default in Windows.[5]", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "OS API Execution": ["", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"]}}
