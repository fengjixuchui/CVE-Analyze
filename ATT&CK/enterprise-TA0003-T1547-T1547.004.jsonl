{"TTP_id": "enterprise-TA0003-T1547-T1547.004", "TTP_name": "Winlogon Helper DLL", "Description": "Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[\\Wow6432Node\\]\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon.[1]Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables. Specifically, the following subkeys have been known to be possibly vulnerable to abuse: [1]Adversaries may take advantage of these features to repeatedly execute malicious code and establish persistence.", "Property": {"ID": "T1547.004", "Sub-technique of": "T1547", "Tactics": "Persistence, Privilege Escalation", "Platforms": "Windows", "Permissions Required": "Administrator, SYSTEM", "CAPEC ID": "CAPEC-579", "Contributors": "Praetorian", "Version": "1.0", "Created": "24 January 2020", "Last Modified": "20 April 2022"}, "Examples": {"S0534": ["https://attack.mitre.org/software/S0534", "Bazar", "Bazar can use Winlogon Helper DLL to establish persistence.[2]"], "S0351": ["https://attack.mitre.org/software/S0351", "Cannon", "Cannon adds the Registry key HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon to establish persistence.[3]"], "S0200": ["https://attack.mitre.org/software/S0200", "Dipsind", "A Dipsind variant registers as a Winlogon Event Notify DLL to establish persistence.[4]"], "S0168": ["https://attack.mitre.org/software/S0168", "Gazer", "Gazer can establish persistence by setting the value \"Shell\" with \"explorer.exe, %malware_pathfile%\" under the Registry key HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon.[5]"], "S0387": ["https://attack.mitre.org/software/S0387", "KeyBoy", "KeyBoy issues the command reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" to achieve persistence.[6] [7]"], "S0375": ["https://attack.mitre.org/software/S0375", "Remexi", "Remexi achieves persistence using Userinit by adding the Registry key HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit.[8]"], "G0081": ["https://attack.mitre.org/groups/G0081", "Tropic Trooper", "Tropic Trooper has created the Registry key HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell and sets the value to establish persistence.[9][10]"], "G0010": ["https://attack.mitre.org/groups/G0010", "Turla", "Turla established persistence by adding a Shell value under the Registry key HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon.[11]"], "G0102": ["https://attack.mitre.org/groups/G0102", "Wizard Spider", "Wizard Spider has established persistence using Userinit by adding the Registry key HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon.[12]"]}, "Mitigation": {"M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Identify and block potentially malicious software that may be executed through the Winlogon helper process by using application control [13] tools like AppLocker [14] [15] that are capable of auditing and/or blocking unknown DLLs."], "M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "Limit the privileges of user accounts so that only authorized administrators can perform Winlogon helper changes."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that may abuse features of Winlogon to execute DLLs and/or executables when a user logs in.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "Module Load": ["New DLLs written to System32 that do not correlate with known good software or patching may also be suspicious. Look for abnormal process behavior that may be due to a process loading a malicious DLL. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as network connections made for Command and Control, learning details about the environment through Discovery, and Lateral Movement.", "DS0011", "https://attack.mitre.org/datasources/DS0011", "Module"], "Windows Registry Key Modification": ["Monitor for changes to Registry entries associated with Winlogon that do not correlate with known software, patch cycles, etc. Tools such as Sysinternals Autoruns may also be used to detect system changes that could be attempts at persistence, including listing current Winlogon helper values. [16]", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
