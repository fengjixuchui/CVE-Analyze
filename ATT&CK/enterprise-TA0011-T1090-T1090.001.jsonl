{"TTP_id": "enterprise-TA0011-T1090-T1090.001", "TTP_name": "Internal Proxy", "Description": "Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment.By using a compromised internal system as a proxy, adversaries may conceal the true destination of C2 traffic while reducing the need for numerous connections to external systems.", "Property": {"ID": "T1090.001", "Sub-technique of": "T1090", "Tactic": "Command and Control", "Platforms": "Linux, Windows, macOS", "Version": "1.0", "Created": "14 March 2020", "Last Modified": "15 March 2020"}, "Examples": {"G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 has used SSH port forwarding capabilities on public-facing systems, and configured at least one instance of Cobalt Strike to use a network pipe over SMB during the 2020 SolarWinds intrusion.[2][3]"], "G0087": ["https://attack.mitre.org/groups/G0087", "APT39", "APT39 used custom tools to create SOCK5 and custom protocol proxies between infected hosts.[4][5]"], "S0031": ["https://attack.mitre.org/software/S0031", "BACKSPACE", "The \"ZJ\" variant of BACKSPACE allows \"ZJ link\" infections with Internet access to relay traffic from \"ZJ listen\" to a command server.[6]"], "S0023": ["https://attack.mitre.org/software/S0023", "CHOPSTICK", "CHOPSTICK used a proxy server between victims and the C2 server.[7]"], "S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can be configured to have commands relayed over a peer-to-peer network of infected hosts. This can be used to limit the number of egress points, or provide access to a host without direct internet access.[8][9]"], "S0502": ["https://attack.mitre.org/software/S0502", "Drovorub", "Drovorub can use a port forwarding rule on its agent module to relay network traffic through the client module to a remote host on the same network.[10]"], "S0038": ["https://attack.mitre.org/software/S0038", "Duqu", "Duqu can be configured to have commands relayed over a peer-to-peer network of infected hosts if some of the hosts do not have Internet access.[11]"], "S0512": ["https://attack.mitre.org/software/S0512", "FatDuke", "FatDuke can used pipes to connect machines with restricted internet access to remote machines via other infected hosts.[12]"], "G0126": ["https://attack.mitre.org/groups/G0126", "Higaisa", "Higaisa discovered system proxy settings and used them if available.[13]"], "S0009": ["https://attack.mitre.org/software/S0009", "Hikit", "Hikit supports peer connections.[14]"], "S0260": ["https://attack.mitre.org/software/S0260", "InvisiMole", "InvisiMole can function as a proxy to create a server that relays communication between the client and C&C server, or between two clients.[15]"], "S0265": ["https://attack.mitre.org/software/S0265", "Kazuar", "Kazuar has used internal nodes on the compromised network for C2 communications.[16]"], "G0032": ["https://attack.mitre.org/groups/G0032", "Lazarus Group", "Lazarus Group has used a compromised router to serve as a proxy between a victim network's corporate and restricted segments.[17]"], "S0051": ["https://attack.mitre.org/software/S0051", "MiniDuke", "MiniDuke can can use a named pipe to forward communications from one compromised machine with internet access to other compromised machines.[12]"], "S0699": ["https://attack.mitre.org/software/S0699", "Mythic", "Mythic can leverage a peer-to-peer C2 profile between agents.[18]"], "G0116": ["https://attack.mitre.org/groups/G0116", "Operation Wocao", "Operation Wocao can proxy traffic through multiple infected systems.[19]"], "S0556": ["https://attack.mitre.org/software/S0556", "Pay2Key", "Pay2Key has designated machines in the compromised network to serve as reverse proxy pivot points to channel communications with C2.[20][21]"], "G0041": ["https://attack.mitre.org/groups/G0041", "Strider", "Strider has used local servers with both local network and Internet access to act as internal proxy nodes to exfiltrate data from other parts of the network without direct Internet access.[22]"], "S0603": ["https://attack.mitre.org/software/S0603", "Stuxnet", "Stuxnet installs an RPC server for P2P communications.[23]"], "G0010": ["https://attack.mitre.org/groups/G0010", "Turla", "Turla has compromised internal network systems to act as a proxy to forward traffic to C2.[24]"], "S0141": ["https://attack.mitre.org/software/S0141", "Winnti for Windows", "The Winnti for Windows HTTP/S C2 mode can make use of a local proxy.[25]"]}, "Mitigation": {"M1031": ["https://attack.mitre.org/mitigations/M1031", "Network Intrusion Prevention", "Network intrusion detection and prevention systems that use network signatures to identify traffic for specific adversary malware can be used to mitigate activity at the network level. Signatures are often for unique indicators within protocols and may be based on the specific C2 protocol used by a particular adversary or tool, and will likely be different across various malware families and versions. Adversaries will likely change tool C2 signatures over time or construct protocols in such a way as to avoid detection by common defensive tools.[26]"]}, "Detection": {"Network Connection Creation": ["Monitor for newly constructed network connections that are sent or received by untrusted hosts.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Network Traffic Content": ["Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure). Consider correlation with process monitoring and command line to detect anomalous processes execution and command line arguments associated to traffic patterns (e.g. monitor anomalies in use of files that do not normally initiate connections for respective protocol(s)).", "", "", ""], "Network Traffic Flow": ["Monitor network data for uncommon data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.", "", "", ""]}}
