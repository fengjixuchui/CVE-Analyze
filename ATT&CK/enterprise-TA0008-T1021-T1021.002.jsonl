{"TTP_id": "enterprise-TA0008-T1021-T1021.002", "TTP_name": "SMB/Windows Admin Shares", "Description": "Adversaries may use Valid Accounts to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user.SMB is a file, printer, and serial port sharing protocol for Windows machines on the same network or domain. Adversaries may use SMB to interact with file shares, allowing them to move laterally throughout a network. Linux and macOS implementations of SMB typically use Samba.Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. Adversaries may use this technique in conjunction with administrator-level Valid Accounts to remotely access a networked system over SMB,[1] to interact with systems using remote procedure calls (RPCs),[2] transfer files, and run transferred binaries through remote Execution. Example execution techniques that rely on authenticated sessions over SMB/RPC are Scheduled Task/Job, Service Execution, and Windows Management Instrumentation. Adversaries can also use NTLM hashes to access administrator shares on systems with Pass the Hash and certain configuration and patch levels.[3]", "Property": {"ID": "T1021.002", "Sub-technique of": "T1021", "Tactic": "Lateral Movement", "Platforms": "Windows", "System Requirements": "SMB enabled; Host/network firewalls not blocking SMB ports between source and destination; Use of domain account in administrator group on remote system or default system admin account.", "Permissions Required": "Administrator, User", "CAPEC ID": "CAPEC-561", "Version": "1.0", "Created": "11 February 2020", "Last Modified": "23 March 2020"}, "Examples": {"S0504": ["https://attack.mitre.org/software/S0504", "Anchor", "Anchor can support windows execution via SMB shares.[4]"], "G0007": ["https://attack.mitre.org/groups/G0007", "APT28", "APT28 has mapped network drives using Net and administrator credentials.[5]"], "G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 has used administrative accounts to connect over SMB to targeted users.[6]"], "G0022": ["https://attack.mitre.org/groups/G0022", "APT3", "APT3 will copy files over to Windows Admin Shares (like ADMIN$) as part of lateral movement.[7]"], "G0050": ["https://attack.mitre.org/groups/G0050", "APT32", "APT32 used Net to use Windows' hidden network shares to copy their tools to remote machines for execution.[8]"], "G0087": ["https://attack.mitre.org/groups/G0087", "APT39", "APT39 has used SMB for lateral movement.[9]"], "G0096": ["https://attack.mitre.org/groups/G0096", "APT41", "APT41 has transferred implant files using Windows Admin Shares.[10]"], "S0089": ["https://attack.mitre.org/software/S0089", "BlackEnergy", "BlackEnergy has run a plug-in on a victim to spread through the local network by using PsExec and accessing admin shares.[11]"], "G0108": ["https://attack.mitre.org/groups/G0108", "Blue Mockingbird", "Blue Mockingbird has used Windows Explorer to manually copy malicious files to remote hosts over SMB.[12]"], "G0114": ["https://attack.mitre.org/groups/G0114", "Chimera", "Chimera has used Windows admin shares to move laterally.[13][14]"], "S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can use Window admin shares (C$ and ADMIN$) for lateral movement.[15]"], "S0608": ["https://attack.mitre.org/software/S0608", "Conficker", "Conficker variants spread through NetBIOS share propagation.[16]"], "S0575": ["https://attack.mitre.org/software/S0575", "Conti", "Conti can spread via SMB and encrypts files on different hosts, potentially compromising an entire network.[17][18]"], "G0009": ["https://attack.mitre.org/groups/G0009", "Deep Panda", "Deep Panda uses net.exe to connect to network shares using net use commands with compromised credentials.[19]"], "S0659": ["https://attack.mitre.org/software/S0659", "Diavol", "Diavol can spread throughout a network via SMB prior to encryption.[20]"], "S0038": ["https://attack.mitre.org/software/S0038", "Duqu", "Adversaries can instruct Duqu to spread laterally by copying itself to shares it has enumerated and for which it has obtained legitimate credentials (via keylogging or other means). The remote host is then infected by using the compromised credentials to schedule a task on remote machines that executes the malware.[21]"], "S0367": ["https://attack.mitre.org/software/S0367", "Emotet", "Emotet leverages the Admin$ share for lateral movement once the local admin password has been brute forced. [22]"], "G0061": ["https://attack.mitre.org/groups/G0061", "FIN8", "FIN8 has attempted to map to C$ on enumerated hosts to test the scope of their current credentials/context.[23]"], "G0117": ["https://attack.mitre.org/groups/G0117", "Fox Kitten", "Fox Kitten has used valid accounts to access SMB shares.[24]"], "S0698": ["https://attack.mitre.org/software/S0698", "HermeticWizard", "HermeticWizard can use a list of hardcoded credentials to to authenticate via NTLMSSP to the SMB shares on remote systems.[25]"], "G0004": ["https://attack.mitre.org/groups/G0004", "Ke3chang", "Ke3chang actors have been known to copy files to the network shares of other computers to move laterally.[26][27]"], "S0236": ["https://attack.mitre.org/software/S0236", "Kwampirs", "Kwampirs copies itself over network shares to move laterally on a victim network.[28]"], "G0032": ["https://attack.mitre.org/groups/G0032", "Lazarus Group", "Lazarus Group malware SierraAlfa accesses the ADMIN$ share via SMB to conduct lateral movement.[29][30]"], "S0532": ["https://attack.mitre.org/software/S0532", "Lucifer", "Lucifer can infect victims by brute forcing SMB.[31]"], "S0039": ["https://attack.mitre.org/software/S0039", "Net", "Lateral movement can be done with Net through net use commands to connect to the on remote systems.[32]"], "S0056": ["https://attack.mitre.org/software/S0056", "Net Crawler", "Net Crawler uses Windows admin shares to establish authenticated sessions to remote systems over SMB as part of lateral movement.[33]"], "S0368": ["https://attack.mitre.org/software/S0368", "NotPetya", "NotPetya can use PsExec, which interacts with the ADMIN$ network share to execute commands on remote systems.[34][35][36]"], "S0365": ["https://attack.mitre.org/software/S0365", "Olympic Destroyer", "Olympic Destroyer uses PsExec to interact with the ADMIN$ network share to execute commands on remote systems.[37][36]"], "G0116": ["https://attack.mitre.org/groups/G0116", "Operation Wocao", "Operation Wocao has used Impacket's smbexec.py as well as accessing the C$ and IPC$ shares to move laterally.[38]"], "G0071": ["https://attack.mitre.org/groups/G0071", "Orangeworm", "Orangeworm has copied its backdoor across open network shares, including ADMIN$, C$WINDOWS, D$WINDOWS, and E$WINDOWS.[28]"], "S0029": ["https://attack.mitre.org/software/S0029", "PsExec", "PsExec, a tool that has been used by adversaries, writes programs to the ADMIN$ network share to execute commands on remote systems.[36]"], "S0019": ["https://attack.mitre.org/software/S0019", "Regin", "The Regin malware platform can use Windows admin shares to move laterally.[39]"], "S0446": ["https://attack.mitre.org/software/S0446", "Ryuk", "Ryuk has used the C$ network share for lateral movement.[40]"], "G0034": ["https://attack.mitre.org/groups/G0034", "Sandworm Team", "Sandworm Team has run net use to connect to network shares.[41]"], "S0140": ["https://attack.mitre.org/software/S0140", "Shamoon", "Shamoon accesses network share(s), enables share access to the target device, copies an executable payload to the target system, and uses a Scheduled Task/Job to execute the malware.[42]"], "S0603": ["https://attack.mitre.org/software/S0603", "Stuxnet", "Stuxnet propagates to available network shares.[43]"], "G0028": ["https://attack.mitre.org/groups/G0028", "Threat Group-1314", "Threat Group-1314 actors mapped network drives using net use.[44]"], "G0010": ["https://attack.mitre.org/groups/G0010", "Turla", "Turla used net use commands to connect to lateral systems within a network.[45]"], "G0102": ["https://attack.mitre.org/groups/G0102", "Wizard Spider", "Wizard Spider has used SMB to drop Cobalt Strike Beacon on a domain controller for lateral movement.[46][47]"], "S0672": ["https://attack.mitre.org/software/S0672", "Zox", "Zox has the ability to use SMB for communication.[48]"], "S0350": ["https://attack.mitre.org/software/S0350", "zwShell", "zwShell has been copied over network shares to move laterally.[49]"]}, "Mitigation": {"M1037": ["https://attack.mitre.org/mitigations/M1037", "Filter Network Traffic", "Consider using the host firewall to restrict file sharing communications such as SMB. [50]"], "M1035": ["https://attack.mitre.org/mitigations/M1035", "Limit Access to Resource Over Network", "Consider disabling Windows administrative shares."], "M1027": ["https://attack.mitre.org/mitigations/M1027", "Password Policies", "Do not reuse local administrator account passwords across systems. Ensure password complexity and uniqueness such that the passwords cannot be cracked or guessed."], "M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Deny remote use of local admin credentials to log into systems. Do not allow domain user accounts to be in the local Administrators group multiple systems."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that connect to remote shares, such as Net, on the command-line interface and Discovery techniques that could be used to find remotely accessible systems.[51]", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "Logon Session Creation": ["Monitor for logon behavior (ex: EID 4624 Logon Type 3) using Valid Accounts to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user. Ensure that proper logging of accounts used to log into systems is turned on and centrally collected. Windows logging is able to collect success/failure for accounts that may be used to move laterally and can be collected using tools such as Windows Event Forwarding. [52][53]", "DS0028", "https://attack.mitre.org/datasources/DS0028", "Logon Session"], "Network Share Access": ["Monitor interactions with network shares, such as reads or file transfers, using Server Message Block (SMB).", "DS0033", "https://attack.mitre.org/datasources/DS0033", "Network Share"], "Network Connection Creation": ["Monitor for newly constructed network connections (typically over ports 139 or 445), especially those that are sent or received by abnormal or untrusted hosts. Correlate these network connections with remote login events and associated SMB-related activity such as file transfers and remote process execution.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Network Traffic Flow": ["Monitor network data for uncommon SMB data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.", "", "", ""]}}
