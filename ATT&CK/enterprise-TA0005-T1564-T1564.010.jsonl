{"TTP_id": "enterprise-TA0005-T1564-T1564.010", "TTP_name": "Process Argument Spoofing", "Description": "Adversaries may attempt to hide process command-line arguments by overwriting process memory. Process command-line arguments are stored in the process environment block (PEB), a data structure used by Windows to store various information about/used by a process. The PEB includes the process command-line arguments that are referenced when executing the process. When a process is created, defensive tools/sensors that monitor process creations may retrieve the process arguments from the PEB.[1][2]Adversaries may manipulate a process PEB to evade defenses. For example, Process Hollowing can be abused to spawn a process in a suspended state with benign arguments. After the process is spawned and the PEB is initialized (and process information is potentially logged by tools/sensors), adversaries may override the PEB to modify the command-line arguments (ex: using the Native API WriteProcessMemory() function) then resume process execution with malicious arguments.[3][2][4]Adversaries may also execute a process with malicious command-line arguments then patch the memory with benign arguments that may bypass subsequent process memory analysis.[5]This behavior may also be combined with other tricks (such as Parent PID Spoofing) to manipulate or further evade process-based detections.", "Property": {"ID": "T1564.010", "Sub-technique of": "T1564", "Tactic": "Defense Evasion", "Platforms": "Windows", "Permissions Required": "User", "Version": "1.0", "Created": "19 November 2021", "Last Modified": "29 November 2021"}, "Examples": {"S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can use spoof arguments in spawned processes that execute beacon commands.[6]"], "S0615": ["https://attack.mitre.org/software/S0615", "SombRAT", "SombRAT has the ability to modify its process memory to hide process command-line arguments.[5]"]}, "Mitigation": {}, "Detection": {"Process Creation": ["Analyze process behavior to determine if a process is performing actions it usually does not and/or do no align with its logged command-line arguments.Detection of process argument spoofing may be difficult as adversaries may momentarily modify stored arguments used for malicious execution. These changes may bypass process creation detection and/or later process memory analysis. Consider monitoring for Process Hollowing, which includes monitoring for process creation (especially those in a suspended state) as well as access and/or modifications of these processes (especially by the parent process) via Windows API calls.[4][7]", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"]}}
