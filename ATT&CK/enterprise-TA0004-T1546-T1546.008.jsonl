{"TTP_id": "enterprise-TA0004-T1546-T1546.008", "TTP_name": "Accessibility Features", "Description": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Windows contains accessibility features that may be launched with a key combination before a user has logged in (ex: when the user is on the Windows logon screen). An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system.Two common accessibility programs are C:\\Windows\\System32\\sethc.exe, launched when the shift key is pressed five times and C:\\Windows\\System32\\utilman.exe, launched when the Windows + U key combination is pressed. The sethc.exe program is often referred to as \"sticky keys\", and has been used by adversaries for unauthenticated access through a remote desktop login screen. [1]Depending on the version of Windows, an adversary may take advantage of these features in different ways. Common methods used by adversaries include replacing accessibility feature binaries or pointers/references to these binaries in the Registry. In newer versions of Windows, the replaced binary needs to be digitally signed for x64 systems, the binary must reside in %systemdir%\\, and it must be protected by Windows File or Resource Protection (WFP/WRP). [2] The Image File Execution Options Injection debugger method was likely discovered as a potential workaround because it does not require the corresponding accessibility feature binary to be replaced.For simple binary replacement on Windows XP and later as well as and Windows Server 2003/R2 and later, for example, the program (e.g., C:\\Windows\\System32\\utilman.exe) may be replaced with \"cmd.exe\" (or another program that provides backdoor access). Subsequently, pressing the appropriate key combination at the login screen while sitting at the keyboard or when connected over Remote Desktop Protocol will cause the replaced file to be executed with SYSTEM privileges. [3]Other accessibility features exist that may also be leveraged in a similar fashion: [2][4]", "Property": {"ID": "T1546.008", "Sub-technique of": "T1546", "Tactics": "Privilege Escalation, Persistence", "Platforms": "Windows", "Permissions Required": "Administrator", "Effective Permissions": "SYSTEM", "CAPEC ID": "CAPEC-558", "Contributors": "Paul Speulstra, AECOM Global Security Operations Center", "Version": "1.0", "Created": "24 January 2020", "Last Modified": "13 May 2020"}, "Examples": {"G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 used sticky-keys to obtain unauthenticated, privileged console access.[5][6]"], "G0022": ["https://attack.mitre.org/groups/G0022", "APT3", "APT3 replaces the Sticky Keys binary C:\\Windows\\System32\\sethc.exe for persistence.[7]"], "G0096": ["https://attack.mitre.org/groups/G0096", "APT41", "APT41 leveraged sticky keys to establish persistence.[8]"], "G0001": ["https://attack.mitre.org/groups/G0001", "Axiom", "Axiom actors have been known to use the Sticky Keys replacement within RDP sessions to obtain persistence.[9]"], "G0009": ["https://attack.mitre.org/groups/G0009", "Deep Panda", "Deep Panda has used the sticky-keys technique to bypass the RDP login screen on remote systems during intrusions.[10]"], "S0363": ["https://attack.mitre.org/software/S0363", "Empire", "Empire can leverage WMI debugging to remotely replace binaries like sethc.exe, Utilman.exe, and Magnify.exe with cmd.exe.[11]"], "G0117": ["https://attack.mitre.org/groups/G0117", "Fox Kitten", "Fox Kitten has used sticky keys to launch a command prompt.[12]"]}, "Mitigation": {"M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Adversaries can replace accessibility features binaries with alternate binaries to execute this technique. Identify and block potentially malicious software executed through accessibility features functionality by using application control [13] tools, like Windows Defender Application Control[14], AppLocker, [15] [16] or Software Restriction Policies [17] where appropriate. [18]"], "M1035": ["https://attack.mitre.org/mitigations/M1035", "Limit Access to Resource Over Network", "If possible, use a Remote Desktop Gateway to manage connections and security configuration of RDP within a network.[19]"], "M1028": ["https://attack.mitre.org/mitigations/M1028", "Operating System Configuration", "To use this technique remotely, an adversary must use it in conjunction with RDP. Ensure that Network Level Authentication is enabled to force the remote desktop session to authenticate before the session is created and the login screen displayed. It is enabled by default on Windows Vista and later.[20]"]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Command line invocation of tools capable of modifying the Registry for associated keys are also suspicious. Utility arguments and the binaries themselves should be monitored for changes.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Creation": ["Monitor newly constructed files that may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features.", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "File Modification": ["Monitor for changes made to files that may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Changes to accessibility utility binaries or binary paths that do not correlate with known software, patch cycles, etc., are suspicious.", "", "", ""], "Process Creation": ["Monitor newly executed processes that may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Windows Registry Key Modification": ["Monitor Registry keys within HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
