{"TTP_id": "enterprise-TA0007-T1012", "TTP_name": "Query Registry", "Description": "Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.The Registry contains a significant amount of information about the operating system, configuration, software, and security.[1] Information can easily be queried using the Reg utility, though other means to access the Registry exist. Some of the information may help adversaries to further their operation within a network. Adversaries may use the information from Query Registry during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.", "Property": {"ID": "T1012", "Sub-techniques": "No sub-techniques", "Tactic": "Discovery", "Platforms": "Windows", "Permissions Required": "Administrator, SYSTEM, User", "CAPEC ID": "CAPEC-647", "Version": "1.2", "Created": "31 May 2017", "Last Modified": "26 March 2020"}, "Examples": {"S0045": ["https://attack.mitre.org/software/S0045", "ADVSTORESHELL", "ADVSTORESHELL can enumerate registry keys.[2][3]"], "G0050": ["https://attack.mitre.org/groups/G0050", "APT32", "APT32's backdoor can query the Windows Registry to gather system information. [4]"], "G0087": ["https://attack.mitre.org/groups/G0087", "APT39", "APT39 has used various strains of malware to query the Registry.[5]"], "S0438": ["https://attack.mitre.org/software/S0438", "Attor", "Attor has opened the registry and performed query searches.[6]"], "S0344": ["https://attack.mitre.org/software/S0344", "Azorult", "Azorult can check for installed software on the system under the Registry key Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall.[7]"], "S0414": ["https://attack.mitre.org/software/S0414", "BabyShark", "BabyShark has executed the reg query command for HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default.[8]"], "S0031": ["https://attack.mitre.org/software/S0031", "BACKSPACE", "BACKSPACE is capable of enumerating and making modifications to an infected system's Registry.[9]"], "S0239": ["https://attack.mitre.org/software/S0239", "Bankshot", "Bankshot searches for certain Registry keys to be configured before executing the payload.[10]"], "S0534": ["https://attack.mitre.org/software/S0534", "Bazar", "Bazar can query Windows\\CurrentVersion\\Uninstall for installed applications.[11][12]"], "S0574": ["https://attack.mitre.org/software/S0574", "BendyBear", "BendyBear can query the host's Registry key at HKEY_CURRENT_USER\\Console\\QuickEdit to retrieve data.[13]"], "S0268": ["https://attack.mitre.org/software/S0268", "Bisonal", "Bisonal has used the RegQueryValueExA function to retrieve proxy information in the Registry.[14]"], "S0570": ["https://attack.mitre.org/software/S0570", "BitPaymer", "BitPaymer can use the RegEnumKeyW to iterate through Registry keys.[15]"], "S0252": ["https://attack.mitre.org/software/S0252", "Brave Prince", "Brave Prince gathers information about the Registry.[16]"], "S0030": ["https://attack.mitre.org/software/S0030", "Carbanak", "Carbanak checks the Registry key HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings for proxy configurations information.[17]"], "S0484": ["https://attack.mitre.org/software/S0484", "Carberp", "Carberp has searched the Image File Execution Options registry key for \"Debugger\" within every subkey.[18]"], "S0335": ["https://attack.mitre.org/software/S0335", "Carbon", "Carbon enumerates values in the Registry.[19]"], "S0348": ["https://attack.mitre.org/software/S0348", "Cardinal RAT", "Cardinal RAT contains watchdog functionality that periodically ensures HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load is set to point to its executable.[20]"], "S0674": ["https://attack.mitre.org/software/S0674", "CharmPower", "CharmPower has the ability to enumerate Uninstall registry values.[21]"], "G0114": ["https://attack.mitre.org/groups/G0114", "Chimera", "Chimera has queried Registry keys using reg query \\\\HKU\\\\SOFTWARE\\Microsoft\\Terminal Server Client\\Servers and reg query \\\\HKU\\\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings.[22]"], "S0023": ["https://attack.mitre.org/software/S0023", "CHOPSTICK", "CHOPSTICK provides access to the Windows Registry, which can be used to gather information.[23]"], "S0660": ["https://attack.mitre.org/software/S0660", "Clambling", "Clambling has the ability to enumerate Registry keys, including KEY_CURRENT_USER\\Software\\Bitcoin\\Bitcoin-Qt\\strDataDir to search for a bitcoin wallet.[24][25]"], "S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can query HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\\\Excel\\Security\\AccessVBOM\\ to determine if the security setting for restricting default programmatic access is enabled.[26][27]"], "S0126": ["https://attack.mitre.org/software/S0126", "ComRAT", "ComRAT can check the default browser by querying HKCR\\http\\shell\\open\\command.[28]"], "S0115": ["https://attack.mitre.org/software/S0115", "Crimson", "Crimson can check the Registry for the presence of HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\last_edate to determine how long it has been installed on a host.[29]"], "S0673": ["https://attack.mitre.org/software/S0673", "DarkWatchman", "DarkWatchman can query the Registry to determine if it has already been installed on the system.[30]"], "S0354": ["https://attack.mitre.org/software/S0354", "Denis", "Denis queries the Registry for keys and values.[31]"], "S0021": ["https://attack.mitre.org/software/S0021", "Derusbi", "Derusbi is capable of enumerating Registry keys and values.[32]"], "S0186": ["https://attack.mitre.org/software/S0186", "DownPaper", "DownPaper searches and reads the value of the Windows Update Registry Run key.[33]"], "G0035": ["https://attack.mitre.org/groups/G0035", "Dragonfly", "Dragonfly has queried the Registry to identify victim information.[34]"], "S0567": ["https://attack.mitre.org/software/S0567", "Dtrack", "Dtrack can collect the RegisteredOwner, RegisteredOrganization, and InstallDate registry values.[35]"], "S0091": ["https://attack.mitre.org/software/S0091", "Epic", "Epic uses the rem reg query command to obtain values from Registry keys.[36]"], "S0512": ["https://attack.mitre.org/software/S0512", "FatDuke", "FatDuke can get user agent strings for the default browser from HKCU\\Software\\Classes\\http\\shell\\open\\command.[37]"], "S0267": ["https://attack.mitre.org/software/S0267", "FELIXROOT", "FELIXROOT queries the Registry for specific keys for potential privilege escalation and proxy information. FELIXROOT has also used WMI to query the Windows Registry.[38][39]"], "S0182": ["https://attack.mitre.org/software/S0182", "FinFisher", "FinFisher queries Registry values as part of its anti-sandbox checks.[40][41]"], "G0117": ["https://attack.mitre.org/groups/G0117", "Fox Kitten", "Fox Kitten has accessed Registry hives ntuser.dat and UserClass.dat.[42]"], "S0666": ["https://attack.mitre.org/software/S0666", "Gelsemium", "Gelsemium can open random files and Registry keys to obscure malware behavior from sandbox analysis.[43]"], "S0032": ["https://attack.mitre.org/software/S0032", "gh0st RAT", "gh0st RAT has checked for the existence of a Service key to determine if it has already been installed on the system.[44]"], "S0249": ["https://attack.mitre.org/software/S0249", "Gold Dragon", "Gold Dragon enumerates registry keys with the command regkeyenum and obtains information for the Registry key HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run.[16]"], "S0376": ["https://attack.mitre.org/software/S0376", "HOPLIGHT", "A variant of HOPLIGHT hooks lsass.exe, and lsass.exe then checks the Registry for the data value 'rdpproto' under the key SYSTEM\\CurrentControlSet\\Control\\Lsa Name.[45]"], "S0203": ["https://attack.mitre.org/software/S0203", "Hydraq", "Hydraq creates a backdoor through which remote attackers can retrieve system information, such as CPU speed, from Registry keys.[46][47]"], "S0604": ["https://attack.mitre.org/software/S0604", "Industroyer", "Industroyer has a data wiper component that enumerates keys in the Registry HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services.[48]"], "S0260": ["https://attack.mitre.org/software/S0260", "InvisiMole", "InvisiMole can enumerate Registry values, keys, and data.[49]"], "S0201": ["https://attack.mitre.org/software/S0201", "JPIN", "JPIN can enumerate Registry keys.[50]"], "G0094": ["https://attack.mitre.org/groups/G0094", "Kimsuky", "Kimsuky has obtained specific Registry keys and values on a compromised host.[51]"], "G0032": ["https://attack.mitre.org/groups/G0032", "Lazarus Group", "Lazarus Group malware IndiaIndia checks Registry keys within HKCU and HKLM to determine if certain applications are present, including SecureCRT, Terminal Services, RealVNC, TightVNC, UltraVNC, Radmin, mRemote, TeamViewer, FileZilla, pcAnyware, and Remote Desktop. Another Lazarus Group malware sample checks for the presence of the following Registry key:HKEY_CURRENT_USER\\Software\\Bitcoin\\Bitcoin-Qt.[52][53][54]"], "S0513": ["https://attack.mitre.org/software/S0513", "LiteDuke", "LiteDuke can query the Registry to check for the presence of HKCU\\Software\\KasperskyLab.[37]"], "S0680": ["https://attack.mitre.org/software/S0680", "LitePower", "LitePower can query the Registry for keys added to execute COM hijacking.[55]"], "S0532": ["https://attack.mitre.org/software/S0532", "Lucifer", "Lucifer can check for existing stratum cryptomining information in HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\spreadCpuXmr â€“ %stratum info%.[56]"], "S0385": ["https://attack.mitre.org/software/S0385", "njRAT", "njRAT can read specific registry values.[57]"], "G0049": ["https://attack.mitre.org/groups/G0049", "OilRig", "OilRig has used reg query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\" on a victim to query the Registry.[58]"], "G0116": ["https://attack.mitre.org/groups/G0116", "Operation Wocao", "Operation Wocao has queried the registry to detect recent PuTTY sessions.[59]"], "S0165": ["https://attack.mitre.org/software/S0165", "OSInfo", "OSInfo queries the registry to look for information about Terminal Services.[60]"], "S0517": ["https://attack.mitre.org/software/S0517", "Pillowmint", "Pillowmint has used shellcode which reads code stored in the registry keys \\REGISTRY\\SOFTWARE\\Microsoft\\DRM using the native Windows API as well as read HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters\\Interfaces as part of its C2.[61]"], "S0013": ["https://attack.mitre.org/software/S0013", "PlugX", "PlugX can enumerate and query for information contained within the Windows Registry.[62][63]"], "S0145": ["https://attack.mitre.org/software/S0145", "POWERSOURCE", "POWERSOURCE queries Registry keys in preparation for setting Run keys to achieve persistence.[64]"], "S0194": ["https://attack.mitre.org/software/S0194", "PowerSploit", "PowerSploit contains a collection of Privesc-PowerUp modules that can query Registry keys for potential opportunities.[65][66]"], "S0184": ["https://attack.mitre.org/software/S0184", "POWRUNER", "POWRUNER may query the Registry by running reg query on a victim.[67]"], "S0238": ["https://attack.mitre.org/software/S0238", "Proxysvc", "Proxysvc gathers product names from the Registry key: HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion ProductName and the processor description from the Registry key HKLM\\HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0 ProcessorNameString.[68]"], "S0269": ["https://attack.mitre.org/software/S0269", "QUADAGENT", "QUADAGENT checks if a value exists within a Registry key in the HKCU hive whose name is the same as the scheduled task it has created.[69]"], "S0241": ["https://attack.mitre.org/software/S0241", "RATANKBA", "RATANKBA uses the command reg query \"HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\InternetSettings\".[70]"], "S0172": ["https://attack.mitre.org/software/S0172", "Reaver", "Reaver queries the Registry to determine the correct Startup path to use for persistence.[71]"], "S0075": ["https://attack.mitre.org/software/S0075", "Reg", "Reg may be used to gather details from the Windows Registry of a local or remote system at the command-line interface.[72]"], "S0496": ["https://attack.mitre.org/software/S0496", "REvil", "REvil can query the Registry to get random file extensions to append to encrypted files.[73]"], "S0240": ["https://attack.mitre.org/software/S0240", "ROKRAT", "ROKRAT can access the HKLM\\System\\CurrentControlSet\\Services\\mssmbios\\Data\\SMBiosData Registry key to obtain the System manufacturer value to identify the machine type.[74]"], "S0140": ["https://attack.mitre.org/software/S0140", "Shamoon", "Shamoon queries several Registry keys to identify hard disk partitions to overwrite.[75]"], "S0589": ["https://attack.mitre.org/software/S0589", "Sibot", "Sibot has queried the registry for proxy server information.[76]"], "S0692": ["https://attack.mitre.org/software/S0692", "SILENTTRINITY", "SILENTTRINITY can use the GetRegValue function to check Registry keys within HKCU\\Software\\Policies\\Microsoft\\Windows\\Installer\\AlwaysInstallElevated and HKLM\\Software\\Policies\\Microsoft\\Windows\\Installer\\AlwaysInstallElevated. It also contains additional modules that can check software AutoRun values and use the Win32 namespace to get values from HKCU, HKLM, HKCR, and HKCC hives.[77]"], "S0627": ["https://attack.mitre.org/software/S0627", "SodaMaster", "SodaMaster has the ability to query the Registry to detect a key specific to VMware.[78]"], "G0038": ["https://attack.mitre.org/groups/G0038", "Stealth Falcon", "Stealth Falcon malware attempts to determine the installed version of .NET by querying the Registry.[79]"], "S0380": ["https://attack.mitre.org/software/S0380", "StoneDrill", "StoneDrill has looked in the registry to find the default browser path.[80]"], "S0603": ["https://attack.mitre.org/software/S0603", "Stuxnet", "Stuxnet searches the Registry for indicators of security programs.[81]"], "S0559": ["https://attack.mitre.org/software/S0559", "SUNBURST", "SUNBURST collected the registry value HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MachineGuid from compromised hosts.[82]"], "S0242": ["https://attack.mitre.org/software/S0242", "SynAck", "SynAck enumerates Registry keys associated with event logs.[83]"], "S0011": ["https://attack.mitre.org/software/S0011", "Taidoor", "Taidoor can query the Registry on compromised hosts using RegQueryValueExA.[84]"], "S0560": ["https://attack.mitre.org/software/S0560", "TEARDROP", "TEARDROP checked that HKU\\SOFTWARE\\Microsoft\\CTF existed before decoding its embedded payload.[82][85]"], "G0027": ["https://attack.mitre.org/groups/G0027", "Threat Group-3390", "A Threat Group-3390 tool can read and decrypt stored Registry values.[86]"], "S0668": ["https://attack.mitre.org/software/S0668", "TinyTurla", "TinyTurla can query the Registry for its configuration information.[87]"], "G0010": ["https://attack.mitre.org/groups/G0010", "Turla", "Turla surveys a system upon check-in to discover information in the Windows Registry with the reg query command.[36] Turla has also retrieved PowerShell payloads hidden in Registry keys as well as checking keys associated with null session named pipes .[88]"], "S0386": ["https://attack.mitre.org/software/S0386", "Ursnif", "Ursnif has used Reg to query the Registry for installed programs.[89][90]"], "S0476": ["https://attack.mitre.org/software/S0476", "Valak", "Valak can use the Registry for code updates and to collect credentials.[91]"], "S0180": ["https://attack.mitre.org/software/S0180", "Volgmer", "Volgmer checks the system for certain Registry keys.[92]"], "S0612": ["https://attack.mitre.org/software/S0612", "WastedLocker", "WastedLocker checks for specific registry keys related to the UCOMIEnumConnections and IActiveScriptParseProcedure32 interfaces.[93]"], "S0579": ["https://attack.mitre.org/software/S0579", "Waterbear", "Waterbear can query the Registry key \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\MSDTC\\MTxOCI\" to see if the value OracleOcilib exists.[94]"], "S0155": ["https://attack.mitre.org/software/S0155", "WINDSHIELD", "WINDSHIELD can gather Registry values.[95]"], "S0251": ["https://attack.mitre.org/software/S0251", "Zebrocy", "Zebrocy executes the reg query command to obtain information in the Registry.[96]"], "S0330": ["https://attack.mitre.org/software/S0330", "Zeus Panda", "Zeus Panda checks for the existence of a Registry key and if it contains certain values.[97]"], "G0128": ["https://attack.mitre.org/groups/G0128", "ZIRCONIUM", "ZIRCONIUM has used a tool to query the Registry for proxy settings.[98]"], "S0412": ["https://attack.mitre.org/software/S0412", "ZxShell", "ZxShell can query the netsvc group value data located in the svchost group Registry key.[99]"]}, "Mitigation": {}, "Detection": {"Command Execution": ["Monitor executed commands and arguments for actions that may interact with the Windows Registry to gather information about the system, configuration, and installed software.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "OS API Execution": ["Monitor for API calls (such as RegOpenKeyExA) that may interact with the Windows Registry to gather information about the system, configuration, and installed software.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Process Creation": ["Monitor for newly executed processes that may interact with the Windows Registry to gather information about the system, configuration, and installed software.", "", "", ""], "Windows Registry Key Access": ["Monitor for unexpected process interactions with the Windows Registry (i.e. reads) that may be related to gathering information.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
