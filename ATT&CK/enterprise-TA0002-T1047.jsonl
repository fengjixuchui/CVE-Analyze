{"TTP_id": "enterprise-TA0002-T1047", "TTP_name": "Windows Management Instrumentation", "Description": "Adversaries may abuse Windows Management Instrumentation (WMI) to execute malicious commands and payloads. WMI is an administration feature that provides a uniform environment to access Windows system components. The WMI service enables both local and remote access, though the latter is facilitated by Remote Services such as Distributed Component Object Model (DCOM) and Windows Remote Management (WinRM).[1] Remote WMI over DCOM operates using port 135, whereas WMI over WinRM operates over port 5985 when using HTTP and 5986 for HTTPS.[1][2]An adversary can use WMI to interact with local and remote systems and use it as a means to execute various behaviors, such as gathering information for Discovery as well as remote Execution of files as part of Lateral Movement. [3] [2]", "Property": {"ID": "T1047", "Sub-techniques": "No sub-techniques", "Tactic": "Execution", "Platforms": "Windows", "Supports Remote": "Yes", "Contributors": "@ionstorm", "Version": "1.2", "Created": "31 May 2017", "Last Modified": "20 April 2022"}, "Examples": {"S0331": ["https://attack.mitre.org/software/S0331", "Agent Tesla", "Agent Tesla has used wmi queries to gather information from the system.[4]"], "G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 used WMI to steal credentials and execute backdoors at a future time.[5] They have also used WMI for the remote execution of files for lateral movement.[6][7]"], "G0050": ["https://attack.mitre.org/groups/G0050", "APT32", "APT32 used WMI to deploy their tools on remote machines and to gather information about the Outlook process.[8]"], "G0096": ["https://attack.mitre.org/groups/G0096", "APT41", "APT41 used WMI in several ways, including for execution of commands via WMIEXEC as well as for persistence via PowerSploit.[9][10]"], "S0373": ["https://attack.mitre.org/software/S0373", "Astaroth", "Astaroth uses WMIC to execute payloads. [11]"], "S0640": ["https://attack.mitre.org/software/S0640", "Avaddon", "Avaddon uses wmic.exe to delete shadow copies.[12]"], "S0534": ["https://attack.mitre.org/software/S0534", "Bazar", "Bazar can execute a WMI query to gather information about the installed antivirus engine.[13][14]"], "S0089": ["https://attack.mitre.org/software/S0089", "BlackEnergy", "A BlackEnergy 2 plug-in uses WMI to gather victim host details.[15]"], "G0108": ["https://attack.mitre.org/groups/G0108", "Blue Mockingbird", "Blue Mockingbird has used wmic.exe to set environment variables.[16]"], "S0674": ["https://attack.mitre.org/software/S0674", "CharmPower", "CharmPower can use wmic to gather information from a system.[17]"], "G0114": ["https://attack.mitre.org/groups/G0114", "Chimera", "Chimera has used WMIC to execute remote commands.[18][19]"], "S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can use WMI to deliver a payload to a remote host.[20][21]"], "S0488": ["https://attack.mitre.org/software/S0488", "CrackMapExec", "CrackMapExec can execute remote commands using Windows Management Instrumentation.[22]"], "S0673": ["https://attack.mitre.org/software/S0673", "DarkWatchman", "DarkWatchman can use WMI to execute commands.[23]"], "S0616": ["https://attack.mitre.org/software/S0616", "DEATHRANSOM", "DEATHRANSOM has the ability to use WMI to delete volume shadow copies.[24]"], "G0009": ["https://attack.mitre.org/groups/G0009", "Deep Panda", "The Deep Panda group is known to utilize WMI for lateral movement.[25]"], "S0062": ["https://attack.mitre.org/software/S0062", "DustySky", "The DustySky dropper uses Windows Management Instrumentation to extract information about the operating system and whether an anti-virus is active.[26]"], "S0605": ["https://attack.mitre.org/software/S0605", "EKANS", "EKANS can use Windows Mangement Instrumentation (WMI) calls to execute operations.[27]"], "S0367": ["https://attack.mitre.org/software/S0367", "Emotet", "Emotet has used WMI to execute powershell.exe.[28]"], "S0363": ["https://attack.mitre.org/software/S0363", "Empire", "Empire can use WMI to deliver a payload to a remote host.[29]"], "S0396": ["https://attack.mitre.org/software/S0396", "EvilBunny", "EvilBunny has used WMI to gather information about the system.[30]"], "S0568": ["https://attack.mitre.org/software/S0568", "EVILNUM", "EVILNUM has used the Windows Management Instrumentation (WMI) tool to enumerate infected machines.[31]"], "S0267": ["https://attack.mitre.org/software/S0267", "FELIXROOT", "FELIXROOT uses WMI to query the Windows Registry.[32]"], "G0037": ["https://attack.mitre.org/groups/G0037", "FIN6", "FIN6 has used WMI to automate the remote execution of PowerShell scripts.[33]"], "G0046": ["https://attack.mitre.org/groups/G0046", "FIN7", "FIN7 has used WMI to install malware on targeted systems.[34]"], "G0061": ["https://attack.mitre.org/groups/G0061", "FIN8", "FIN8's malicious spearphishing payloads use WMI to launch malware and spawn cmd.exe execution. FIN8 has also used WMIC for lateral movement as well as during and post compromise cleanup activities.[35][36][37]"], "S0618": ["https://attack.mitre.org/software/S0618", "FIVEHANDS", "FIVEHANDS can use WMI to delete files on a target machine.[24][38]"], "S0381": ["https://attack.mitre.org/software/S0381", "FlawedAmmyy", "FlawedAmmyy leverages WMI to enumerate anti-virus on the victim.[39]"], "G0101": ["https://attack.mitre.org/groups/G0101", "Frankenstein", "Frankenstein has used WMI queries to check if various security applications were running, as well as the operating system version.[40]"], "G0093": ["https://attack.mitre.org/groups/G0093", "GALLIUM", "GALLIUM used WMI for execution to assist in lateral movement as well as for installing tools across multiple assets.[41]"], "G0047": ["https://attack.mitre.org/groups/G0047", "Gamaredon Group", "Gamaredon Group has used WMI to execute scripts used for discovery.[42]"], "S0237": ["https://attack.mitre.org/software/S0237", "GravityRAT", "GravityRAT collects various information via WMI requests, including CPU information in the Win32_Processor entry (Processor ID, Name, Manufacturer and the clock speed).[43]"], "S0151": ["https://attack.mitre.org/software/S0151", "HALFBAKED", "HALFBAKED can use WMI queries to gather system information.[44]"], "S0617": ["https://attack.mitre.org/software/S0617", "HELLOKITTY", "HELLOKITTY can use WMI to delete volume shadow copies.[24]"], "S0698": ["https://attack.mitre.org/software/S0698", "HermeticWizard", "HermeticWizard can use WMI to create a new process on a remote machine via C:\\windows\\system32\\cmd.exe /c start C:\\windows\\system32\\\\regsvr32.exe /s /iC:\\windows\\<filename>.dll.[45]"], "S0376": ["https://attack.mitre.org/software/S0376", "HOPLIGHT", "HOPLIGHT has used WMI to recompile the Managed Object Format (MOF) files in the WMI repository.[46]"], "S0483": ["https://attack.mitre.org/software/S0483", "IcedID", "IcedID has used WMI to execute binaries.[47]"], "S0357": ["https://attack.mitre.org/software/S0357", "Impacket", "Impacket's wmiexec module can be used to execute commands through WMI.[48]"], "G0119": ["https://attack.mitre.org/groups/G0119", "Indrik Spider", "Indrik Spider has used WMIC to execute commands on remote computers.[49]"], "S0283": ["https://attack.mitre.org/software/S0283", "jRAT", "jRAT uses WMIC to identify anti-virus products installed on the victim’s machine and to obtain firewall details.[50]"], "S0265": ["https://attack.mitre.org/software/S0265", "Kazuar", "Kazuar obtains a list of running processes through WMI querying.[51]"], "S0250": ["https://attack.mitre.org/software/S0250", "Koadic", "Koadic can use WMI to execute commands.[52]"], "S0156": ["https://attack.mitre.org/software/S0156", "KOMPROGO", "KOMPROGO is capable of running WMI queries.[53]"], "G0032": ["https://attack.mitre.org/groups/G0032", "Lazarus Group", "Lazarus Group has used WMIC for discovery as well as to execute payloads for persistence and lateral movement.[54][55][56][57][58]"], "G0065": ["https://attack.mitre.org/groups/G0065", "Leviathan", "Leviathan has used WMI for execution.[59]"], "S0532": ["https://attack.mitre.org/software/S0532", "Lucifer", "Lucifer can use WMI to log into remote machines for propagation.[60]"], "S0449": ["https://attack.mitre.org/software/S0449", "Maze", "Maze has used WMI to attempt to delete the shadow volumes on a machine, and to connect a virtual machine to the network domain of the victim organization's network.[61][62]"], "G0045": ["https://attack.mitre.org/groups/G0045", "menuPass", "menuPass has used a modified version of pentesting script wmiexec.vbs, which logs into a remote machine using WMI.[63][64][65]"], "S0688": ["https://attack.mitre.org/software/S0688", "Meteor", "Meteor can use wmic.exe as part of its effort to delete shadow copies.[66]"], "S0339": ["https://attack.mitre.org/software/S0339", "Micropsia", "Micropsia searches for anti-virus software and firewall products installed on the victim’s machine using WMI.[67][68]"], "S0553": ["https://attack.mitre.org/software/S0553", "MoleNet", "MoleNet can perform WMI commands on the system.[69]"], "S0256": ["https://attack.mitre.org/software/S0256", "Mosquito", "Mosquito's installer uses WMI to search for antivirus display names.[70]"], "G0069": ["https://attack.mitre.org/groups/G0069", "MuddyWater", "MuddyWater has used malware that leveraged WMI for execution and querying host information.[71][72][73]"], "G0129": ["https://attack.mitre.org/groups/G0129", "Mustang Panda", "Mustang Panda has executed PowerShell scripts via WMI.[74][75]"], "G0019": ["https://attack.mitre.org/groups/G0019", "Naikon", "Naikon has used WMIC.exe for lateral movement.[76]"], "S0457": ["https://attack.mitre.org/software/S0457", "Netwalker", "Netwalker can use WMI to delete Shadow Volumes.[77]"], "S0368": ["https://attack.mitre.org/software/S0368", "NotPetya", "NotPetya can use wmic to help propagate itself across a network.[78][79]"], "S0340": ["https://attack.mitre.org/software/S0340", "Octopus", "Octopus has used wmic.exe for local discovery information.[80]"], "G0049": ["https://attack.mitre.org/groups/G0049", "OilRig", "OilRig has used WMI for execution.[81]"], "S0365": ["https://attack.mitre.org/software/S0365", "Olympic Destroyer", "Olympic Destroyer uses WMI to help propagate itself across a network.[82]"], "S0264": ["https://attack.mitre.org/software/S0264", "OopsIE", "OopsIE uses WMI to perform discovery techniques.[83]"], "G0116": ["https://attack.mitre.org/groups/G0116", "Operation Wocao", "Operation Wocao has used WMI to execute commands.[84]"], "S0378": ["https://attack.mitre.org/software/S0378", "PoshC2", "PoshC2 has a number of modules that use WMI to execute tasks.[85]"], "S0194": ["https://attack.mitre.org/software/S0194", "PowerSploit", "PowerSploit's Invoke-WmiCommand CodeExecution module uses WMI to execute and retrieve the output from a PowerShell payload.[86][87]"], "S0223": ["https://attack.mitre.org/software/S0223", "POWERSTATS", "POWERSTATS can use WMI queries to retrieve data from compromised hosts.[88][72]"], "S0184": ["https://attack.mitre.org/software/S0184", "POWRUNER", "POWRUNER may use WMI when collecting information about a victim.[89]"], "S0654": ["https://attack.mitre.org/software/S0654", "ProLock", "ProLock can use WMIC to execute scripts on targeted hosts.[90]"], "S0650": ["https://attack.mitre.org/software/S0650", "QakBot", "QakBot can execute WMI queries to gather information.[91]"], "S0241": ["https://attack.mitre.org/software/S0241", "RATANKBA", "RATANKBA uses WMI to perform process monitoring.[92][93]"], "S0375": ["https://attack.mitre.org/software/S0375", "Remexi", "Remexi executes received commands with wmic.exe (for WMI commands). [94]"], "S0496": ["https://attack.mitre.org/software/S0496", "REvil", "REvil can use WMI to monitor for and kill specific processes listed in its configuration file.[95][96]"], "S0270": ["https://attack.mitre.org/software/S0270", "RogueRobin", "RogueRobin uses various WMI queries to check if the sample is running in a sandbox.[97][98]"], "G0034": ["https://attack.mitre.org/groups/G0034", "Sandworm Team", "Sandworm Team has used VBScript to run WMI queries.[99]"], "S0546": ["https://attack.mitre.org/software/S0546", "SharpStage", "SharpStage can use WMI for execution.[69][100]"], "S0589": ["https://attack.mitre.org/software/S0589", "Sibot", "Sibot has used WMI to discover network connections and configurations. Sibot has also used the Win32_Process class to execute a malicious DLL.[101]"], "S0692": ["https://attack.mitre.org/software/S0692", "SILENTTRINITY", "SILENTTRINITY can use WMI for lateral movement.[102]"], "G0038": ["https://attack.mitre.org/groups/G0038", "Stealth Falcon", "Stealth Falcon malware gathers system information via Windows Management Instrumentation (WMI).[103]"], "S0380": ["https://attack.mitre.org/software/S0380", "StoneDrill", "StoneDrill has used the WMI command-line (WMIC) utility to run tasks.[104]"], "S0603": ["https://attack.mitre.org/software/S0603", "Stuxnet", "Stuxnet used WMI with an explorer.exe token to execute on a remote share.[105]"], "S0559": ["https://attack.mitre.org/software/S0559", "SUNBURST", "SUNBURST used the WMI query Select * From Win32_SystemDriver to retrieve a driver listing.[106]"], "S0663": ["https://attack.mitre.org/software/S0663", "SysUpdate", "SysUpdate can use WMI for execution on a compromised host.[107]"], "G0027": ["https://attack.mitre.org/groups/G0027", "Threat Group-3390", "A Threat Group-3390 tool can use WMI to execute a binary.[108]"], "S0386": ["https://attack.mitre.org/software/S0386", "Ursnif", "Ursnif droppers have used WMI classes to execute PowerShell commands.[109]"], "S0476": ["https://attack.mitre.org/software/S0476", "Valak", "Valak can use wmic process call create in a scheduled task to launch plugins and for execution.[110]"], "S0366": ["https://attack.mitre.org/software/S0366", "WannaCry", "WannaCry utilizes wmic to delete shadow copies.[111][112][113]"], "G0112": ["https://attack.mitre.org/groups/G0112", "Windshift", "Windshift has used WMI to collect information about target machines.[114]"], "G0102": ["https://attack.mitre.org/groups/G0102", "Wizard Spider", "Wizard Spider has used WMI and LDAP queries for network discovery and to move laterally.[115][116][117][118]"], "S0251": ["https://attack.mitre.org/software/S0251", "Zebrocy", "One variant of Zebrocy uses WMI queries to gather information.[119]"]}, "Mitigation": {"M1040": ["https://attack.mitre.org/mitigations/M1040", "Behavior Prevention on Endpoint", "On Windows 10, enable Attack Surface Reduction (ASR) rules to block processes created by WMI commands from running. Note: many legitimate tools and applications utilize WMI for command execution. [120]"], "M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Use application control configured to block execution of wmic.exe if it is not required for a given system or network to prevent potential misuse by adversaries. For example, in Windows 10 and Windows Server 2016 and above, Windows Defender Application Control (WDAC) policy rules may be applied to block the wmic.exe application and to prevent abuse.[121]"], "M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Prevent credential overlap across systems of administrator and privileged accounts. [2]"], "M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "By default, only administrators are allowed to connect remotely using WMI. Restrict other users who are allowed to connect, or disallow all users to connect remotely to WMI."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments for actions that are used to perform remote behavior", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "Network Connection Creation": ["Monitor network traffic for WMI connections; the use of WMI in environments that do not typically use WMI may be suspect.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Process Creation": ["Monitor for newly constructed processes and/or command-lines of \"wmic\"", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"]}}
