{"TTP_id": "enterprise-TA0003-T1547-T1547.012", "TTP_name": "Print Processors", "Description": "Adversaries may abuse print processors to run malicious DLLs during system boot for persistence and/or privilege escalation. Print processors are DLLs that are loaded by the print spooler service, spoolsv.exe, during boot.Adversaries may abuse the print spooler service by adding print processors that load malicious DLLs at startup. A print processor can be installed through the AddPrintProcessor API call with an account that has SeLoadDriverPrivilege enabled. Alternatively, a print processor can be registered to the print spooler service by adding the HKLM\\SYSTEM\\[CurrentControlSet or ControlSet001]\\Control\\Print\\Environments\\[Windows architecture: e.g., Windows x64]\\Print Processors\\[user defined]\\Driver Registry key that points to the DLL. For the print processor to be correctly installed, it must be located in the system print-processor directory that can be found with the GetPrintProcessorDirectory API call.[1] After the print processors are installed, the print spooler service, which starts during boot, must be restarted in order for them to run.[2] The print spooler service runs under SYSTEM level permissions, therefore print processors installed by an adversary may run under elevated privileges.", "Property": {"ID": "T1547.012", "Sub-technique of": "T1547", "Tactics": "Persistence, Privilege Escalation", "Platforms": "Windows", "Permissions Required": "Administrator, SYSTEM", "Contributors": "Mathieu Tartare, ESET", "Version": "1.0", "Created": "05 October 2020", "Last Modified": "09 October 2020"}, "Examples": {"S0666": ["https://attack.mitre.org/software/S0666", "Gelsemium", "Gelsemium can drop itself in C:\\Windows\\System32\\spool\\prtprocs\\x64\\winprint.dll to be loaded automatically by the spoolsv Windows service.[3]"], "S0501": ["https://attack.mitre.org/software/S0501", "PipeMon", "The PipeMon installer has modified the Registry key HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\Windows x64\\Print Processors to install PipeMon as a Print Processor.[2]"]}, "Mitigation": {"M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "Limit user accounts that can load or unload device drivers by disabling SeLoadDriverPrivilege."]}, "Detection": {"Driver Load": ["Monitor for unusual kernel driver installation activity that may abuse print processors to run malicious DLLs during system boot for persistence and/or privilege escalation.", "DS0027", "https://attack.mitre.org/datasources/DS0027", "Driver"], "File Creation": ["Monitor for newly constructed files that may abuse print processors to run malicious DLLs during system boot for persistence and/or privilege escalation.", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Module Load": ["Monitor for abnormal DLLs that are loaded by spoolsv.exe. Print processors that do not correlate with known good software or patching may be suspicious. New print processor DLLs are written to the print processor directory.", "DS0011", "https://attack.mitre.org/datasources/DS0011", "Module"], "OS API Execution": ["Monitor process API calls to AddPrintProcessor and GetPrintProcessorDirectory.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Windows Registry Key Modification": ["Monitor Registry writes to HKLM\\SYSTEM\\ControlSet001\\Control\\Print\\Environments\\[Windows architecture]\\Print Processors\\[user defined]\\Driver or HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\[Windows architecture]\\Print Processors\\[user defined]\\Driver as they pertain to print processor installations.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
