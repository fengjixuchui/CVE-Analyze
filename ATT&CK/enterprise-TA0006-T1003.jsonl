{"TTP_id": "enterprise-TA0006-T1003", "TTP_name": "OS Credential Dumping", "Description": "Adversaries may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information.Several of the tools mentioned in associated sub-techniques may be used by both adversaries and professional security testers. Additional custom tools likely exist as well.", "Property": {"ID": "T1003", "Sub-techniques": "T1003.001, T1003.002, T1003.003, T1003.004, T1003.005, T1003.006, T1003.007, T1003.008", "Tactic": "Credential Access", "Platforms": "Linux, Windows, macOS", "Permissions Required": "Administrator, SYSTEM, root", "Contributors": "Ed Williams, Trustwave, SpiderLabs; Vincent Le Toux", "Version": "2.1", "Created": "31 May 2017", "Last Modified": "08 March 2022"}, "Examples": {"G0007": ["https://attack.mitre.org/groups/G0007", "APT28", "APT28 regularly deploys both publicly available (ex: Mimikatz) and custom password retrieval tools on victims.[1][2][3]"], "G0050": ["https://attack.mitre.org/groups/G0050", "APT32", "APT32 used GetPassword_x64 to harvest credentials.[4][5]"], "G0087": ["https://attack.mitre.org/groups/G0087", "APT39", "APT39 has used different versions of Mimikatz to obtain credentials.[6]"], "G0001": ["https://attack.mitre.org/groups/G0001", "Axiom", "Axiom has been known to dump credentials.[7]"], "S0030": ["https://attack.mitre.org/software/S0030", "Carbanak", "Carbanak obtains Windows logon password details.[8]"], "G0101": ["https://attack.mitre.org/groups/G0101", "Frankenstein", "Frankenstein has harvested credentials from the victim's machine using Empire.[9]"], "S0232": ["https://attack.mitre.org/software/S0232", "HOMEFRY", "HOMEFRY can perform credential dumping.[10]"], "G0065": ["https://attack.mitre.org/groups/G0065", "Leviathan", "Leviathan has used publicly available tools to dump password hashes, including HOMEFRY.[11]"], "S0052": ["https://attack.mitre.org/software/S0052", "OnionDuke", "OnionDuke steals credentials from its victims.[12]"], "S0048": ["https://attack.mitre.org/software/S0048", "PinchDuke", "PinchDuke steals credentials from compromised hosts. PinchDuke's credential stealing functionality is believed to be based on the source code of the Pinch credential stealing malware (also known as LdPinch). Credentials targeted by PinchDuke include ones associated many sources such as WinInet Credential Cache, and Lightweight Directory Access Protocol (LDAP).[12]"], "G0033": ["https://attack.mitre.org/groups/G0033", "Poseidon Group", "Poseidon Group conducts credential dumping on victims, with a focus on obtaining credentials belonging to domain and database servers.[13]"], "S0379": ["https://attack.mitre.org/software/S0379", "Revenge RAT", "Revenge RAT has a plugin for credential harvesting.[14]"], "G0054": ["https://attack.mitre.org/groups/G0054", "Sowbug", "Sowbug has used credential dumping tools.[15]"], "G0039": ["https://attack.mitre.org/groups/G0039", "Suckfly", "Suckfly used a signed credential-dumping tool to obtain victim account credentials.[16]"], "G0131": ["https://attack.mitre.org/groups/G0131", "Tonto Team", "Tonto Team has used a variety of credential dumping tools.[17]"], "S0094": ["https://attack.mitre.org/software/S0094", "Trojan.Karagany", "Trojan.Karagany can dump passwords and save them into \\ProgramData\\Mail\\MailAg\\pwds.txt.[18]"]}, "Mitigation": {"M1015": ["https://attack.mitre.org/mitigations/M1015", "Active Directory Configuration", "Manage the access control list for \"Replicating Directory Changes\" and other permissions associated with domain controller replication. [19] [20] Consider adding users to the \"Protected Users\" Active Directory security group. This can help limit the caching of users' plaintext credentials.[21]"], "M1040": ["https://attack.mitre.org/mitigations/M1040", "Behavior Prevention on Endpoint", "On Windows 10, enable Attack Surface Reduction (ASR) rules to secure LSASS and prevent credential stealing. [22]"], "M1043": ["https://attack.mitre.org/mitigations/M1043", "Credential Access Protection", "With Windows 10, Microsoft implemented new protections called Credential Guard to protect the LSA secrets that can be used to obtain credentials through forms of credential dumping. It is not configured by default and has hardware and firmware system requirements. [23] It also does not protect against all forms of credential dumping. [24]"], "M1041": ["https://attack.mitre.org/mitigations/M1041", "Encrypt Sensitive Information", "Ensure Domain Controller backups are properly secured."], "M1028": ["https://attack.mitre.org/mitigations/M1028", "Operating System Configuration", "Consider disabling or restricting NTLM.[25] Consider disabling WDigest authentication.[26]"], "M1027": ["https://attack.mitre.org/mitigations/M1027", "Password Policies", "Ensure that local administrator accounts have complex, unique passwords across all systems on the network."], "M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Windows:Do not put user or admin domain accounts in the local administrator groups across systems unless they are tightly controlled, as this is often equivalent to having a local administrator account with the same password on all systems. Follow best practices for design and administration of an enterprise network to limit privileged account use across administrative tiers.[27]Linux:Scraping the passwords from memory requires root privileges. Follow best practices in restricting access to privileged accounts to avoid hostile programs from accessing such sensitive regions of memory."], "M1025": ["https://attack.mitre.org/mitigations/M1025", "Privileged Process Integrity", "On Windows 8.1 and Windows Server 2012 R2, enable Protected Process Light for LSA.[28]"], "M1017": ["https://attack.mitre.org/mitigations/M1017", "User Training", "Limit credential overlap across accounts and systems by training users and administrators not to use the same password for multiple accounts."]}, "Detection": {"Active Directory Object Access": ["Monitor domain controller logs for replication requests and other unscheduled activity possibly associated with DCSync. [29] [30] [31] Note: Domain controllers may not log replication requests originating from the default domain controller account. [32]. Monitor for replication requests [33] from IPs not associated with known domain controllers. [19]", "DS0026", "https://attack.mitre.org/datasources/DS0026", "Active Directory"], "Command Execution": ["Monitor executed commands and arguments that may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software. Look for command-lines that invoke AuditD or the Security Accounts Manager (SAM). Remote access tools may contain built-in features or incorporate existing tools like Mimikatz. PowerShell scripts also exist that contain credential dumping functionality, such as PowerSploit's Invoke-Mimikatz module, [34] which may require additional logging features to be configured in the operating system to collect necessary information for analysis.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Access": ["Monitor for hash dumpers opening the Security Accounts Manager (SAM) on the local file system (%SystemRoot%/system32/config/SAM). Some hash dumpers will open the local file system as a device and parse to the SAM table to avoid file access defenses. Others will make an in-memory copy of the SAM table before reading hashes. Detection of compromised ( LinkById: T1078) in-use by adversaries may help as well.", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Network Traffic Content": ["Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure). Consider correlation with process monitoring and command line to detect anomalous processes execution and command line arguments associated to traffic patterns (e.g. monitor anomalies in use of files that do not normally initiate connections for respective protocol(s)).", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Network Traffic Flow": ["Monitor network data for uncommon data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.", "", "", ""], "OS API Execution": ["Monitor for API calls that may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Process Access": ["Monitor for unexpected processes interacting with lsass.exe.[35] Common credential dumpers such as Mimikatz access the LSA Subsystem Service (LSASS) process by opening the process, locating the LSA secrets key, and decrypting the sections in memory where credential details are stored. Credential dumpers may also use methods for reflective Process Injection to reduce potential indicators of malicious activity.To obtain the passwords and hashes stored in memory, processes must open a maps file in the /proc filesystem for the process being analyzed. This file is stored under the path /proc/<pid>/maps, where the <pid> directory is the unique pid of the program being interrogated for such authentication data. The AuditD monitoring tool, which ships stock in many Linux distributions, can be used to watch for hostile processes opening this file in the proc file system, alerting on the pid, process name, and arguments of such programs.", "", "", ""], "Process Creation": ["Monitor for newly executed processes that may be indicative of credential dumping. On Windows 8.1 and Windows Server 2012 R2, monitor Windows Logs for LSASS.exe creation to verify that LSASS started as a protected process.", "", "", ""], "Windows Registry Key Access": ["Monitor for the SAM registry key being accessed that may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
