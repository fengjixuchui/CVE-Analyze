{"TTP_id": "enterprise-TA0005-T1564-T1564.006", "TTP_name": "Run Virtual Instance", "Description": "Adversaries may carry out malicious operations using a virtual instance to avoid detection. A wide variety of virtualization technologies exist that allow for the emulation of a computer or computing environment. By running malicious code inside of a virtual instance, adversaries can hide artifacts associated with their behavior from security tools that are unable to monitor activity inside the virtual instance. Additionally, depending on the virtual networking implementation (ex: bridged adapter), network traffic generated by the virtual instance can be difficult to trace back to the compromised host as the IP address and hostname might not match known values.[1]Adversaries may utilize native support for virtualization (ex: Hyper-V) or drop the necessary files to run a virtual instance (ex: VirtualBox binaries). After running a virtual instance, adversaries may create a shared folder between the guest and host with permissions that enable the virtual instance to interact with the host file system.[2]", "Property": {"ID": "T1564.006", "Sub-technique of": "T1564", "Tactic": "Defense Evasion", "Platforms": "Linux, Windows, macOS", "Permissions Required": "User", "Contributors": "Janantha Marasinghe; Johann Rehberger; Menachem Shafran, XM Cyber", "Version": "1.1", "Created": "29 June 2020", "Last Modified": "14 October 2021"}, "Examples": {"S0451": ["https://attack.mitre.org/software/S0451", "LoudMiner", "LoudMiner has used QEMU and VirtualBox to run a Tiny Core Linux virtual machine, which runs XMRig and makes connections to the C2 server for updates.[3]"], "S0449": ["https://attack.mitre.org/software/S0449", "Maze", "Maze operators have used VirtualBox and a Windows 7 virtual machine to run the ransomware; the virtual machine's configuration file mapped the shared network drives of the target company, presumably so Maze can encrypt files on the shared drives as well as the local machine.[4]"], "S0481": ["https://attack.mitre.org/software/S0481", "Ragnar Locker", "Ragnar Locker has used VirtualBox and a stripped Windows XP virtual machine to run itself. The use of a shared folder specified in the configuration enables Ragnar Locker to encrypt files on the host operating system, including files on any mapped drives.[2]"]}, "Mitigation": {"M1042": ["https://attack.mitre.org/mitigations/M1042", "Disable or Remove Feature or Program", "Disable Hyper-V if not necessary within a given environment."], "M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Use application control to mitigate installation and use of unapproved virtualization software."]}, "Detection": {"Command Execution": ["Consider monitoring for commands and arguments that may be atypical for benign use of virtualization software. Usage of virtualization binaries or command-line arguments associated with running a silent installation may be especially suspect (ex. -silent, -ignore-reboot), as well as those associated with running a headless (in the background with no UI) virtual instance (ex. VBoxManage startvm $VM --type headless).[5] Similarly, monitoring command line arguments which suppress notifications may highlight potentially malicious activity (ex. VBoxManage.exe setextradata global GUI/SuppressMessages \"all\"). Monitor for commands which enable hypervisors such as Hyper-V.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Creation": ["Monitor for newly constructed files associated with running a virtual instance, such as binary files associated with common virtualization technologies (ex: VirtualBox, VMware, QEMU, Hyper-V).", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Image Metadata": ["Consider monitoring the size of virtual machines running on the system. Adversaries may create virtual images which are smaller than those of typical virtual machines.[5] Network adapter information may also be helpful in detecting the use of virtual instances.", "DS0007", "https://attack.mitre.org/datasources/DS0007", "Image"], "Process Creation": ["Monitor newly executed processes associated with running a virtual instance, such as those launched from binary files associated with common virtualization technologies (ex: VirtualBox, VMware, QEMU, Hyper-V).", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Service Creation": ["Monitor for newly constructed services/daemons that may carry out malicious operations using a virtual instance to avoid detection. Consider monitoring for new Windows Service, with respect to virtualization software.", "DS0019", "https://attack.mitre.org/datasources/DS0019", "Service"], "Windows Registry Key Modification": ["Monitor for changes made to Windows Registry keys and/or values that may be the result of using a virtual instance to avoid detection. For example, if virtualization software is installed by the adversary the Registry may provide detection opportunities.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
