{"TTP_id": "enterprise-TA0007-T1482", "TTP_name": "Domain Trust Discovery", "Description": "Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments. Domain trusts provide a mechanism for a domain to allow access to resources based on the authentication procedures of another domain.[1] Domain trusts allow the users of the trusted domain to access resources in the trusting domain. The information discovered may help the adversary conduct SID-History Injection, Pass the Ticket, and Kerberoasting.[2][3] Domain trusts can be enumerated using the DSEnumerateDomainTrusts() Win32 API call, .NET methods, and LDAP.[3] The Windows utility Nltest is known to be used by adversaries to enumerate domain trusts.[4]", "Property": {"ID": "T1482", "Sub-techniques": "No sub-techniques", "Tactic": "Discovery", "Platforms": "Windows", "Contributors": "Dave Westgard; Elia Florio, Microsoft; Mnemonic; RedHuntLabs, @redhuntlabs", "Version": "1.1", "Created": "14 February 2019", "Last Modified": "05 April 2022"}, "Examples": {"S0552": ["https://attack.mitre.org/software/S0552", "AdFind", "AdFind can gather information about organizational units (OUs) and domain trusts from Active Directory.[5][6][7]"], "G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 used the Get-AcceptedDomain PowerShell cmdlet to enumerate accepted domains through an Exchange Management Shell.[8] They also used AdFind to enumerate domains and to discover trust between federated domains.[9][10]"], "S0534": ["https://attack.mitre.org/software/S0534", "Bazar", "Bazar can use Nltest tools to obtain information about the domain.[11][12]"], "S0521": ["https://attack.mitre.org/software/S0521", "BloodHound", "BloodHound has the ability to map domain trusts and identify misconfigurations for potential abuse.[13]"], "G0114": ["https://attack.mitre.org/groups/G0114", "Chimera", "Chimera has nltest /domain_trusts to identify domain trust relationships.[14]"], "S0105": ["https://attack.mitre.org/software/S0105", "dsquery", "dsquery can be used to gather information on domain trusts with dsquery * -filter \"(objectClass=trustedDomain)\" -attr *.[3]"], "S0363": ["https://attack.mitre.org/software/S0363", "Empire", "Empire has modules for enumerating domain trusts.[15]"], "G0061": ["https://attack.mitre.org/groups/G0061", "FIN8", "FIN8 has retrieved a list of trusted domains by using Nltest.exe /domain_trusts.[16]"], "S0359": ["https://attack.mitre.org/software/S0359", "Nltest", "Nltest may be used to enumerate trusted domains by using commands such as nltest /domain_trusts.[17][18]"], "S0378": ["https://attack.mitre.org/software/S0378", "PoshC2", "PoshC2 has modules for enumerating domain trusts.[19]"], "S0194": ["https://attack.mitre.org/software/S0194", "PowerSploit", "PowerSploit has modules such as Get-NetDomainTrust and Get-NetForestTrust to enumerate domain and forest trusts.[20][21]"], "S0650": ["https://attack.mitre.org/software/S0650", "QakBot", "QakBot can run nltest /domain_trusts /all_trusts for domain trust discovery.[22]"], "S0266": ["https://attack.mitre.org/software/S0266", "TrickBot", "TrickBot can gather information about domain trusts by utilizing Nltest.[18][23]"]}, "Mitigation": {"M1047": ["https://attack.mitre.org/mitigations/M1047", "Audit", "Map the trusts within existing domains/forests and keep trust relationships to a minimum."], "M1030": ["https://attack.mitre.org/mitigations/M1030", "Network Segmentation", "Employ network segmentation for sensitive domains.[3]."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments for actions that could be taken to gather system and network information, such as nltest /domain_trusts. Remote access tools with built-in features may interact directly with the Windows API to gather information.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "OS API Execution": ["Monitor for API calls associated with gathering information on domain trust relationships that may be used to identify lateral movement like DSEnumerateDomainTrusts() Win32 API call to spot activity associated with Domain Trust Discovery.[3] Information may also be acquired through Windows system management tools such as PowerShell. The .NET method GetAllTrustRelationships() can be an indicator of Domain Trust Discovery.[24]", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Process Creation": ["Monitor for newly executed processes that may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.", "", "", ""], "Script Execution": ["Monitor for any attempts to enable scripts running on a system would be considered suspicious. If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions are suspicious. Scripts should be captured from the file system when possible to determine their actions and intent.", "DS0012", "https://attack.mitre.org/datasources/DS0012", "Script"]}}
