{"TTP_id": "enterprise-TA0006-T1187", "TTP_name": "Forced Authentication", "Description": "Adversaries may gather credential material by invoking or forcing a user to automatically provide authentication information through a mechanism in which they can intercept.The Server Message Block (SMB) protocol is commonly used in Windows networks for authentication and communication between systems for access to resources and file sharing. When a Windows system attempts to connect to an SMB resource it will automatically attempt to authenticate and send credential information for the current user to the remote system. [1] This behavior is typical in enterprise environments so that users do not need to enter credentials to access network resources.Web Distributed Authoring and Versioning (WebDAV) is also typically used by Windows systems as a backup protocol when SMB is blocked or fails. WebDAV is an extension of HTTP and will typically operate over TCP ports 80 and 443. [2] [3]Adversaries may take advantage of this behavior to gain access to user account hashes through forced SMB/WebDAV authentication. An adversary can send an attachment to a user through spearphishing that contains a resource link to an external server controlled by the adversary (i.e. Template Injection), or place a specially crafted file on navigation path for privileged accounts (e.g. .SCF file placed on desktop) or on a publicly accessible share to be accessed by victim(s). When the user's system accesses the untrusted resource it will attempt authentication and send information, including the user's hashed credentials, over SMB to the adversary controlled server. [4] With access to the credential hash, an adversary can perform off-line Brute Force cracking to gain access to plaintext credentials. [5]There are several different ways this can occur. [6] Some specifics from in-the-wild use include:", "Property": {"ID": "T1187", "Sub-techniques": "No sub-techniques", "Tactic": "Credential Access", "Platforms": "Windows", "Permissions Required": "User", "Contributors": "Sudhanshu Chauhan, @Sudhanshu_C; Teodor Cimpoesu", "Version": "1.2", "Created": "16 January 2018", "Last Modified": "19 June 2020"}, "Examples": {"G0079": ["https://attack.mitre.org/groups/G0079", "DarkHydrus", "DarkHydrus used Template Injection to launch an authentication window for users to enter their credentials.[8]"], "G0035": ["https://attack.mitre.org/groups/G0035", "Dragonfly", "Dragonfly has gathered hashed user credentials over SMB using spearphishing attachments with external resource links and by modifying .LNK file icon resources to collect credentials from virtualized systems.[9][10]"], "S0634": ["https://attack.mitre.org/software/S0634", "EnvyScout", "EnvyScout can use protocol handlers to coax the operating system to send NTLMv2 authentication responses to attacker-controlled infrastructure.[11]"]}, "Mitigation": {"M1037": ["https://attack.mitre.org/mitigations/M1037", "Filter Network Traffic", "Block SMB traffic from exiting an enterprise network with egress filtering or by blocking TCP ports 139, 445 and UDP port 137. Filter or block WebDAV protocol traffic from exiting the network. If access to external resources over SMB and WebDAV is necessary, then traffic should be tightly limited with allowlisting. [12] [7]"], "M1027": ["https://attack.mitre.org/mitigations/M1027", "Password Policies", "Use strong passwords to increase the difficulty of credential hashes from being cracked if they are obtained."]}, "Detection": {"File Access": ["Monitor for unexpected files used to gather credentials when the files are rendered", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "File Creation": ["Monitor for newly constructed .LNK, .SCF, or any other files on systems and within virtual environments that contain resources that point to external network resources", "", "", ""], "File Modification": ["Monitor for changes made to the .LNK, .SCF, or any other files on systems and within virtual environments that contain resources that point to external network resources", "", "", ""], "Network Traffic Content": ["For internal traffic, monitor the workstation-to-workstation unusual (vs. baseline) SMB traffic. For many networks there should not be any, but it depends on how systems on the network are configured and where resources are located.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Network Traffic Flow": ["Monitor for SMB traffic on TCP ports 139, 445 and UDP port 137 and WebDAV traffic attempting to exit the network to unknown external systems.If attempts are detected, then investigate endpoint data sources to find the root cause.", "", "", ""]}}
