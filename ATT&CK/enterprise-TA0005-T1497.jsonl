{"TTP_id": "enterprise-TA0005-T1497", "TTP_name": "Virtualization/Sandbox Evasion", "Description": "Adversaries may employ various means to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversaries may use the information learned from Virtualization/Sandbox Evasion during automated discovery to shape follow-on behaviors.[1]Adversaries may use several methods to accomplish Virtualization/Sandbox Evasion such as checking for security monitoring tools (e.g., Sysinternals, Wireshark, etc.) or other system artifacts associated with analysis or virtualization. Adversaries may also check for legitimate user activity to help determine if it is in an analysis environment. Additional methods include use of sleep timers or loops within malware code to avoid operating within a temporary sandbox.[2]", "Property": {"ID": "T1497", "Sub-techniques": "T1497.001, T1497.002, T1497.003", "Tactics": "Defense Evasion, Discovery", "Platforms": "Linux, Windows, macOS", "Defense Bypassed": "Anti-virus, Host forensic analysis, Signature-based detection, Static File Analysis", "Contributors": "Deloitte Threat Library Team; Sunny Neo", "Version": "1.3", "Created": "17 April 2019", "Last Modified": "18 October 2021"}, "Examples": {"S0331": ["https://attack.mitre.org/software/S0331", "Agent Tesla", "Agent Tesla has he ability to perform anti-sandboxing and anti-virtualization checks.[3]"], "S0534": ["https://attack.mitre.org/software/S0534", "Bazar", "Bazar can attempt to overload sandbox analysis by sending 1550 calls to printf.[4]"], "S0268": ["https://attack.mitre.org/software/S0268", "Bisonal", "Bisonal can check to determine if the compromised system is running on VMware.[5]"], "S0484": ["https://attack.mitre.org/software/S0484", "Carberp", "Carberp has removed various hooks before installing the trojan or bootkit to evade sandbox analysis or other analysis software.[6]"], "S0023": ["https://attack.mitre.org/software/S0023", "CHOPSTICK", "CHOPSTICK includes runtime checks to identify an analysis environment and prevent execution on it.[7]"], "S0046": ["https://attack.mitre.org/software/S0046", "CozyCar", "Some versions of CozyCar will check to ensure it is not being executed inside a virtual machine or a known malware analysis sandbox environment. If it detects that it is, it will exit.[8]"], "G0012": ["https://attack.mitre.org/groups/G0012", "Darkhotel", "Darkhotel malware has employed just-in-time decryption of strings to evade sandbox detection.[9]"], "S0554": ["https://attack.mitre.org/software/S0554", "Egregor", "Egregor has used multiple anti-analysis and anti-sandbox techniques to prevent automated analysis by sandboxes.[10][11]"], "S0666": ["https://attack.mitre.org/software/S0666", "Gelsemium", "Gelsemium can use junk code to generate random activity to obscure malware behavior.[12]"], "S0499": ["https://attack.mitre.org/software/S0499", "Hancitor", "Hancitor has used a macro to check that an ActiveDocument shape object in the lure message is present. If this object is not found, the macro will exit without downloading additional payloads.[13]"], "S0455": ["https://attack.mitre.org/software/S0455", "Metamorfo", "Metamorfo has embedded a \"vmdetect.exe\" executable to identify virtual machines at the beginning of execution.[14]"], "S0147": ["https://attack.mitre.org/software/S0147", "Pteranodon", "Pteranodon has the ability to use anti-detection functions to identify sandbox environments.[15]"], "S0148": ["https://attack.mitre.org/software/S0148", "RTM", "RTM can detect if it is running within a sandbox or other virtualized analysis environment.[16]"], "S0380": ["https://attack.mitre.org/software/S0380", "StoneDrill", "StoneDrill has used several anti-emulation techniques to prevent automated analysis by emulators or sandboxes.[17]"], "S0689": ["https://attack.mitre.org/software/S0689", "WhisperGate", "WhisperGate can stop its execution when it recognizes the presence of certain monitoring tools.[18]"]}, "Mitigation": {}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that may employ various means to detect and avoid virtualization and analysis environments. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "OS API Execution": ["Monitor for API calls that may employ various means to detect and avoid virtualization and analysis environments. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Process Creation": ["Virtualization, sandbox, user activity, and related discovery techniques will likely occur in the first steps of an operation but may also occur throughout as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as lateral movement, based on the information obtained. Detecting actions related to virtualization and sandbox identification may be difficult depending on the adversary's implementation and monitoring required. Monitoring for suspicious processes being spawned that gather a variety of system information or perform other forms of Discovery, especially in a short period of time, may aid in detection.", "", "", ""]}}
