{"TTP_id": "enterprise-TA0003-T1037-T1037.001", "TTP_name": "Logon Script (Windows)", "Description": "Adversaries may use Windows logon scripts automatically executed at logon initialization to establish persistence. Windows allows logon scripts to be run whenever a specific user or group of users log into a system.[1] This is done via adding a path to a script to the HKCU\\Environment\\UserInitMprLogonScript Registry key.[2]Adversaries may use these scripts to maintain persistence on a single system. Depending on the access configuration of the logon scripts, either local credentials or an administrator account may be necessary.", "Property": {"ID": "T1037.001", "Sub-technique of": "T1037", "Tactics": "Persistence, Privilege Escalation", "Platforms": "Windows", "Version": "1.0", "Created": "10 January 2020", "Last Modified": "24 March 2020"}, "Examples": {"G0007": ["https://attack.mitre.org/groups/G0007", "APT28", "An APT28 loader Trojan adds the Registry key HKCU\\Environment\\UserInitMprLogonScript to establish persistence.[3]"], "S0438": ["https://attack.mitre.org/software/S0438", "Attor", "Attor's dispatcher can establish persistence via adding a Registry key with a logon script HKEY_CURRENT_USER\\Environment \"UserInitMprLogonScript\" .[4]"], "G0080": ["https://attack.mitre.org/groups/G0080", "Cobalt Group", "Cobalt Group has added persistence by registering the file name for the next stage malware under HKCU\\Environment\\UserInitMprLogonScript.[5]"], "S0044": ["https://attack.mitre.org/software/S0044", "JHUHUGIT", "JHUHUGIT has registered a Windows shell script under the Registry key HKCU\\Environment\\UserInitMprLogonScript to establish persistence.[6][7]"], "S0526": ["https://attack.mitre.org/software/S0526", "KGH_SPY", "KGH_SPY has the ability to set the HKCU\\Environment\\UserInitMprLogonScript Registry key to execute logon scripts.[8]"], "S0251": ["https://attack.mitre.org/software/S0251", "Zebrocy", "Zebrocy performs persistence with a logon script via adding to the Registry key HKCU\\Environment\\UserInitMprLogonScript.[9]"]}, "Mitigation": {"M1024": ["https://attack.mitre.org/mitigations/M1024", "Restrict Registry Permissions", "Ensure proper permissions are set for Registry hives to prevent users from modifying keys for logon scripts that may lead to persistence."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments for logon scripts", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "Process Creation": ["Monitor for newly constructed processes and/or command-lines that execute logon scripts", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Windows Registry Key Creation": ["Monitor for the creation/modification to Registry keys associated with Windows logon scrips, nameley HKCU\\Environment\\UserInitMprLogonScript.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
