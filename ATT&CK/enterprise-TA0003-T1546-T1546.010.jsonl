{"TTP_id": "enterprise-TA0003-T1546-T1546.010", "TTP_name": "AppInit DLLs", "Description": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows or HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library. [1]Similar to Process Injection, these values can be abused to obtain elevated privileges by causing a malicious DLL to be loaded and run in the context of separate processes on the computer. [2] Malicious AppInit DLLs may also provide persistence by continuously being triggered by API activity.The AppInit DLL functionality is disabled in Windows 8 and later versions when secure boot is enabled. [3]", "Property": {"ID": "T1546.010", "Sub-technique of": "T1546", "Tactics": "Privilege Escalation, Persistence", "Platforms": "Windows", "System Requirements": "Secure boot disabled on systems running Windows 8 and later", "Permissions Required": "Administrator", "Effective Permissions": "Administrator, SYSTEM", "Version": "1.0", "Created": "24 January 2020", "Last Modified": "10 November 2020"}, "Examples": {"G0087": ["https://attack.mitre.org/groups/G0087", "APT39", "APT39 has used malware to set LoadAppInit_DLLs in the Registry key SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows in order to establish persistence.[4]"], "S0107": ["https://attack.mitre.org/software/S0107", "Cherry Picker", "Some variants of Cherry Picker use AppInit_DLLs to achieve persistence by creating the following Registry key: HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows \"AppInit_DLLs\"=\"pserver32.dll\"[5]"], "S0458": ["https://attack.mitre.org/software/S0458", "Ramsay", "Ramsay can insert itself into the address space of other applications using the AppInit DLL Registry key.[6]"], "S0098": ["https://attack.mitre.org/software/S0098", "T9000", "If a victim meets certain criteria, T9000 uses the AppInit_DLL functionality to achieve persistence by ensuring that every user mode process that is spawned will load its malicious DLL, ResN32.dll. It does this by creating the following Registry keys: HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs – %APPDATA%\\Intel\\ResN32.dll and HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs – 0x1.[7]"]}, "Mitigation": {"M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Adversaries can install new AppInit DLLs binaries to execute this technique. Identify and block potentially malicious software executed through AppInit DLLs functionality by using application control [8] tools, like Windows Defender Application Control[9], AppLocker, [10] [11] or Software Restriction Policies [12] where appropriate. [13]"], "M1051": ["https://attack.mitre.org/mitigations/M1051", "Update Software", "Upgrade to Windows 8 or later and enable secure boot."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "Module Load": ["Monitor DLL loads by processes that load user32.dll and look for DLLs that are not recognized or not normally loaded into a process.", "DS0011", "https://attack.mitre.org/datasources/DS0011", "Module"], "OS API Execution": ["Monitor and analyze application programming interface (API) calls that are indicative of Registry edits such as RegCreateKeyEx and RegSetValueEx. [1]", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Process Creation": ["Monitor newly executed processes that may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes.", "", "", ""], "Windows Registry Key Modification": ["Monitor the AppInit_DLLs Registry values for modifications that do not correlate with known software, patch cycles, etc.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
