{"TTP_id": "enterprise-TA0004-T1543-T1543.004", "TTP_name": "Launch Daemon", "Description": "Adversaries may create or modify Launch Daemons to execute malicious payloads as part of persistence. Launch Daemons are plist files used to interact with Launchd, the service management framework used by macOS. Launch Daemons require elevated privileges to install, are executed for every user on a system prior to login, and run in the background without the need for user interaction. During the macOS initialization startup, the launchd process loads the parameters for launch-on-demand system-level daemons from plist files found in /System/Library/LaunchDaemons/ and /Library/LaunchDaemons/. Required Launch Daemons parameters include a Label to identify the task, Program to provide a path to the executable, and RunAtLoad to specify when the task is run. Launch Daemons are often used to provide access to shared resources, updates to software, or conduct automation tasks.[1][2][3]Adversaries may install a Launch Daemon configured to execute at startup by using the RunAtLoad parameter set to true and the Program parameter set to the malicious executable path. The daemon name may be disguised by using a name from a related operating system or benign software (i.e. Masquerading). When the Launch Daemon is executed, the program inherits administrative permissions.[4][5]Additionally, system configuration changes (such as the installation of third party package managing software) may cause folders such as usr/local/bin to become globally writeable. So, it is possible for poor configurations to allow an adversary to modify executables referenced by current Launch Daemon's plist files.[6][7]", "Property": {"ID": "T1543.004", "Sub-technique of": "T1543", "Tactics": "Persistence, Privilege Escalation", "Platforms": "macOS", "Permissions Required": "Administrator", "Effective Permissions": "Administrator, root", "CAPEC ID": "CAPEC-550, CAPEC-551", "Version": "1.2", "Created": "17 January 2020", "Last Modified": "07 October 2021"}, "Examples": {"S0584": ["https://attack.mitre.org/software/S0584", "AppleJeus", "AppleJeus has placed a plist file within the LaunchDaemons folder and launched it manually.[8]"], "S0482": ["https://attack.mitre.org/software/S0482", "Bundlore", "Bundlore can persist via a LaunchDaemon.[9]"], "S0497": ["https://attack.mitre.org/software/S0497", "Dacls", "Dacls can establish persistence via a Launch Daemon.[10][11]"], "S0690": ["https://attack.mitre.org/software/S0690", "Green Lambert", "Green Lambert can add a plist file in the Library/LaunchDaemons to establish persistence.[12][13]"], "S0451": ["https://attack.mitre.org/software/S0451", "LoudMiner", "LoudMiner adds plist files with the naming format com.[random_name].plist in the /Library/LaunchDaemons folder with the RunAtLoad and KeepAlive keys set to true.[14]"], "S0352": ["https://attack.mitre.org/software/S0352", "OSX_OCEANLOTUS.D", "If running with root permissions, OSX_OCEANLOTUS.D can create a persistence file in the folder /Library/LaunchDaemons.[15][16]"], "S0595": ["https://attack.mitre.org/software/S0595", "ThiefQuest", "When running with root privileges after a Launch Agent is installed, ThiefQuest installs a plist file to the /Library/LaunchDaemons/ folder with the RunAtLoad key set to true establishing persistence as a Launch Daemon. [17]"], "S0658": ["https://attack.mitre.org/software/S0658", "XCSSET", "XCSSET uses the ssh launchdaemon to elevate privileges, bypass system controls, and enable remote access to the victim.[18]"]}, "Mitigation": {"M1047": ["https://attack.mitre.org/mitigations/M1047", "Audit", "Use auditing tools capable of detecting folder permissions abuse opportunities on systems, especially reviewing changes made to folders by third-party software."], "M1018": ["https://attack.mitre.org/mitigations/M1018", "User Account Management", "Limit privileges of user accounts and remediate Privilege Escalation vectors so only authorized administrators can create new Launch Daemons."]}, "Detection": {"Command Execution": ["Some legitimate LaunchDaemons point to unsigned code that could be exploited. For Launch Daemons with the RunAtLoad parameter set to true, ensure the Program parameter points to signed code or executables are in alignment with enterprise policy. Some parameters are interchangeable with others, such as Program and ProgramArguments parameters but one must be present. [3]", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Creation": ["Monitor for new files added to the /Library/LaunchDaemons/ folder. The System LaunchDaemons are protected by SIP.", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "File Modification": ["Monitor files for changes that may create or modify Launch Daemons to execute malicious payloads as part of persistence.", "", "", ""], "Process Creation": ["Monitor for newly executed processes that may create or modify Launch Daemons to execute malicious payloads as part of persistence.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"], "Service Creation": ["Monitor for newly constructed services may create or modify Launch Daemons to execute malicious payloads as part of persistence.", "DS0019", "https://attack.mitre.org/datasources/DS0019", "Service"], "Service Modification": ["Monitor services for changes made to Launch Daemons to execute malicious payloads as part of persistence.", "", "", ""]}}
