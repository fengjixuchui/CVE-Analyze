{"TTP_id": "enterprise-TA0006-T1003-T1003.002", "TTP_name": "Security Account Manager", "Description": "Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through in-memory techniques or through the Windows Registry where the SAM database is stored. The SAM is a database file that contains local accounts for the host, typically those found with the net user command. Enumerating the SAM database requires SYSTEM level access.A number of tools can be used to retrieve the SAM file through in-memory techniques:Alternatively, the SAM can be extracted from the Registry with Reg:Creddump7 can then be used to process the SAM database locally to retrieve hashes.[1]Notes: * RID 500 account is the local, built-in administrator.* RID 501 is the guest account.* User accounts start with a RID of 1,000+.", "Property": {"ID": "T1003.002", "Sub-technique of": "T1003", "Tactic": "Credential Access", "Platforms": "Windows", "Permissions Required": "SYSTEM", "Contributors": "Ed Williams, Trustwave, SpiderLabs", "Version": "1.0", "Created": "11 February 2020", "Last Modified": "25 March 2020"}, "Examples": {"S0154": ["https://attack.mitre.org/software/S0154", "Cobalt Strike", "Cobalt Strike can recover hashed passwords.[2]"], "S0050": ["https://attack.mitre.org/software/S0050", "CosmicDuke", "CosmicDuke collects Windows account hashes.[3]"], "S0046": ["https://attack.mitre.org/software/S0046", "CozyCar", "Password stealer and NTLM stealer modules in CozyCar harvest stored credentials from the victim, including credentials used as part of Windows NTLM user authentication.[4]"], "S0488": ["https://attack.mitre.org/software/S0488", "CrackMapExec", "CrackMapExec can dump usernames and hashed passwords from the SAM.[5]"], "G0035": ["https://attack.mitre.org/groups/G0035", "Dragonfly", "Dragonfly has dropped and executed SecretsDump to dump password hashes.[6]"], "S0120": ["https://attack.mitre.org/software/S0120", "Fgdump", "Fgdump can dump Windows password hashes.[7]"], "G0093": ["https://attack.mitre.org/groups/G0093", "GALLIUM", "GALLIUM used reg commands to dump specific hives from the Windows Registry, such as the SAM hive, and obtain password hashes.[8]"], "S0008": ["https://attack.mitre.org/software/S0008", "gsecdump", "gsecdump can dump Windows password hashes from the SAM.[9]"], "S0376": ["https://attack.mitre.org/software/S0376", "HOPLIGHT", "HOPLIGHT has the capability to harvest credentials and passwords from the SAM database.[10]"], "S0357": ["https://attack.mitre.org/software/S0357", "Impacket", "SecretsDump and Mimikatz modules within Impacket can perform credential dumping to obtain account and password information.[11]"], "G0004": ["https://attack.mitre.org/groups/G0004", "Ke3chang", "Ke3chang has dumped credentials, including by using gsecdump.[12][13]"], "S0250": ["https://attack.mitre.org/software/S0250", "Koadic", "Koadic can gather hashed passwords by dumping SAM/SECURITY hive.[14]"], "G0045": ["https://attack.mitre.org/groups/G0045", "menuPass", "menuPass has used a modified version of pentesting tools wmiexec.vbs and secretsdump.py to dump credentials.[15][16]"], "S0002": ["https://attack.mitre.org/software/S0002", "Mimikatz", "Mimikatz performs credential dumping to obtain account and password information useful in gaining access to additional systems and enterprise network resources. It contains functionality to acquire information about credentials in many ways, including from the SAM table.[17][18][19][20]"], "S0080": ["https://attack.mitre.org/software/S0080", "Mivast", "Mivast has the capability to gather NTLM password information.[21]"], "G0014": ["https://attack.mitre.org/groups/G0014", "Night Dragon", "Night Dragon has dumped account hashes with Carbanak and cracked them with Cain & Abel.[22]"], "S0371": ["https://attack.mitre.org/software/S0371", "POWERTON", "POWERTON has the ability to dump password hashes.[23]"], "S0006": ["https://attack.mitre.org/software/S0006", "pwdump", "pwdump can be used to dump credentials from the SAM.[24]"], "S0125": ["https://attack.mitre.org/software/S0125", "Remsec", "Remsec can dump the SAM database.[25]"], "G0027": ["https://attack.mitre.org/groups/G0027", "Threat Group-3390", "Threat Group-3390 actors have used gsecdump to dump credentials. They have also dumped credentials from domain controllers.[26][27]"], "G0102": ["https://attack.mitre.org/groups/G0102", "Wizard Spider", "Wizard Spider has acquired credentials from the SAM/SECURITY registry hives.[28]"]}, "Mitigation": {"M1028": ["https://attack.mitre.org/mitigations/M1028", "Operating System Configuration", "Consider disabling or restricting NTLM.[29]"], "M1027": ["https://attack.mitre.org/mitigations/M1027", "Password Policies", "Ensure that local administrator accounts have complex, unique passwords across all systems on the network."], "M1026": ["https://attack.mitre.org/mitigations/M1026", "Privileged Account Management", "Do not put user or admin domain accounts in the local administrator groups across systems unless they are tightly controlled, as this is often equivalent to having a local administrator account with the same password on all systems. Follow best practices for design and administration of an enterprise network to limit privileged account use across administrative tiers."], "M1017": ["https://attack.mitre.org/mitigations/M1017", "User Training", "Limit credential overlap across accounts and systems by training users and administrators not to use the same password for multiple accounts."]}, "Detection": {"Command Execution": ["Monitor executed commands and arguments that may attempt to extract credential material from the Security Account Manager (SAM) database either through in-memory techniques or through the Windows Registry where the SAM database is stored.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Access": ["Monitor for hash dumpers opening the Security Accounts Manager (SAM) on the local file system (%SystemRoot%/system32/config/SAM). Some hash dumpers will open the local file system as a device and parse to the SAM table to avoid file access defenses. Others will make an in-memory copy of the SAM table before reading hashes. Detection of compromised Valid Accounts in-use by adversaries may help as well.", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Windows Registry Key Access": ["Monitor for the SAM registry key dump being created to access stored account password hashes. Some hash dumpers will open the local file system as a device and parse to the SAM table to avoid file access defenses. Others will make an in-memory copy of the SAM table before reading hashes. Detection of compromised /techniques/T1078 in-use by adversaries may help as well.", "DS0024", "https://attack.mitre.org/datasources/DS0024", "Windows Registry"]}}
