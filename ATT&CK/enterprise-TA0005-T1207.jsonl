{"TTP_id": "enterprise-TA0005-T1207", "TTP_name": "Rogue Domain Controller", "Description": "Adversaries may register a rogue Domain Controller to enable manipulation of Active Directory data. DCShadow may be used to create a rogue Domain Controller (DC). DCShadow is a method of manipulating Active Directory (AD) data, including objects and schemas, by registering (or reusing an inactive registration) and simulating the behavior of a DC. [1] Once registered, a rogue DC may be able to inject and replicate changes into AD infrastructure for any domain object, including credentials and keys.Registering a rogue DC involves creating a new server and nTDSDSA objects in the Configuration partition of the AD schema, which requires Administrator privileges (either Domain or local to the DC) or the KRBTGT hash. [2]This technique may bypass system logging and security monitors such as security information and event management (SIEM) products (since actions taken on a rogue DC may not be reported to these sensors). [1] The technique may also be used to alter and delete replication and other associated metadata to obstruct forensic analysis. Adversaries may also utilize this technique to perform SID-History Injection and/or manipulate AD objects (such as accounts, access control lists, schemas) to establish backdoors for Persistence. [1]", "Property": {"ID": "T1207", "Sub-techniques": "No sub-techniques", "Tactic": "Defense Evasion", "Platforms": "Windows", "Permissions Required": "Administrator", "Defense Bypassed": "Log analysis", "Contributors": "Vincent Le Toux", "Version": "2.1", "Created": "18 April 2018", "Last Modified": "08 March 2022"}, "Examples": {"S0002": ["https://attack.mitre.org/software/S0002", "Mimikatz", "Mimikatz’s LSADUMP::DCShadow module can be used to make AD updates by temporarily setting a computer to be a DC.[3][2]"]}, "Mitigation": {}, "Detection": {"Active Directory Object Creation": ["Baseline and periodically analyze the Configuration partition of the AD schema and alert on creation of nTDSDSA objects.[1]", "DS0026", "https://attack.mitre.org/datasources/DS0026", "Active Directory"], "Active Directory Object Modification": ["Leverage AD directory synchronization (DirSync) to monitor changes to directory state using AD replication cookies.[4] [5] Also consider monitoring and alerting on the replication of AD objects (Audit Detailed Directory Service Replication Events 4928 and 4929). [1]", "", "", ""], "Network Traffic Content": ["Monitor and analyze network traffic associated with data replication (such as calls to DrsAddEntry, DrsReplicaAdd, and especially GetNCChanges) between DCs as well as to/from non DC hosts. [6][1] DC replication will naturally take place every 15 minutes but can be triggered by an adversary or by legitimate urgent changes (ex: passwords).", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "User Account Authentication": ["Investigate usage of Kerberos Service Principal Names (SPNs), especially those associated with services (beginning with \"GC/\") by computers not present in the DC organizational unit (OU). The SPN associated with the Directory Replication Service (DRS) Remote Protocol interface (GUID E3514235–4B06–11D1-AB04–00C04FC2DCD2) can be set without logging.[5] A rogue DC must authenticate as a service using these two SPNs for the replication process to successfully complete.", "DS0002", "https://attack.mitre.org/datasources/DS0002", "User Account"]}}
