{"TTP_id": "enterprise-TA0011-T1090-T1090.003", "TTP_name": "Multi-hop Proxy", "Description": "To disguise the source of malicious traffic, adversaries may chain together multiple proxies. Typically, a defender will be able to identify the last proxy traffic traversed before it enters their network; the defender may or may not be able to identify any previous proxies before the last-hop proxy. This technique makes identifying the original source of the malicious traffic even more difficult by requiring the defender to trace malicious traffic through several proxies to identify its source. A particular variant of this behavior is to use onion routing networks, such as the publicly available TOR network. [1]In the case of network infrastructure, particularly routers, it is possible for an adversary to leverage multiple compromised devices to create a multi-hop proxy chain within the Wide-Area Network (WAN) of the enterprise. By leveraging Patch System Image, adversaries can add custom code to the affected network devices that will implement onion routing between those nodes. This custom onion routing network will transport the encrypted C2 traffic through the compromised population, allowing adversaries to communicate with any device within the onion routing network. This method is dependent upon the Network Boundary Bridging method in order to allow the adversaries to cross the protected network boundary of the Internet perimeter and into the organizationâ€™s WAN. Protocols such as ICMP may be used as a transport.", "Property": {"ID": "T1090.003", "Sub-technique of": "T1090", "Tactic": "Command and Control", "Platforms": "Linux, Network, Windows, macOS", "Version": "2.0", "Created": "14 March 2020", "Last Modified": "21 October 2020"}, "Examples": {"G0007": ["https://attack.mitre.org/groups/G0007", "APT28", "APT28 has routed traffic over Tor and VPN servers to obfuscate their activities.[2]"], "G0016": ["https://attack.mitre.org/groups/G0016", "APT29", "A backdoor used by APT29 created a Tor hidden service to forward traffic from the Tor client to local ports 3389 (RDP), 139 (Netbios), and 445 (SMB) enabling full remote access from outside the network and has also used TOR.[3][4]"], "S0438": ["https://attack.mitre.org/software/S0438", "Attor", "Attor has used Tor for C2 communication.[5]"], "G0132": ["https://attack.mitre.org/groups/G0132", "CostaRicto", "CostaRicto has used a layer of proxies to manage C2 communications.[6]"], "S0687": ["https://attack.mitre.org/software/S0687", "Cyclops Blink", "Cyclops Blink has used Tor nodes for C2 traffic.[7]"], "S0281": ["https://attack.mitre.org/software/S0281", "Dok", "Dok downloads and installs Tor via homebrew.[8]"], "S0384": ["https://attack.mitre.org/software/S0384", "Dridex", "Dridex can use multiple layers of proxy servers to hide terminal nodes in its infrastructure.[9]"], "G0085": ["https://attack.mitre.org/groups/G0085", "FIN4", "FIN4 has used Tor to log in to victims' email accounts.[10]"], "S0342": ["https://attack.mitre.org/software/S0342", "GreyEnergy", "GreyEnergy has used Tor relays for Command and Control servers.[11]"], "G0100": ["https://attack.mitre.org/groups/G0100", "Inception", "Inception used chains of compromised routers to proxy C2 communications between them and cloud service providers.[12]"], "S0604": ["https://attack.mitre.org/software/S0604", "Industroyer", "Industroyer used Tor nodes for C2.[13]"], "S0276": ["https://attack.mitre.org/software/S0276", "Keydnap", "Keydnap uses a copy of tor2web proxy for HTTPS communications.[14]"], "S0641": ["https://attack.mitre.org/software/S0641", "Kobalos", "Kobalos can chain together multiple compromised machines as proxies to reach their final targets.[15][16]"], "G0065": ["https://attack.mitre.org/groups/G0065", "Leviathan", "Leviathan has used multi-hop proxies to disguise the source of their malicious traffic.[17]"], "S0282": ["https://attack.mitre.org/software/S0282", "MacSpy", "MacSpy uses Tor for command and control.[8]"], "G0116": ["https://attack.mitre.org/groups/G0116", "Operation Wocao", "Operation Wocao has executed commands through the installed web shell via Tor exit nodes.[18]"], "S0623": ["https://attack.mitre.org/software/S0623", "Siloscape", "Siloscape uses Tor to communicate with C2.[19]"], "S0491": ["https://attack.mitre.org/software/S0491", "StrongPity", "StrongPity can use multiple layers of proxy servers to hide terminal nodes in its infrastructure.[20]"], "S0183": ["https://attack.mitre.org/software/S0183", "Tor", "Traffic traversing the Tor network will be forwarded to multiple nodes before exiting the Tor network and continuing on to its intended destination.[21]"], "S0386": ["https://attack.mitre.org/software/S0386", "Ursnif", "Ursnif has used Tor for C2.[22][23]"], "S0366": ["https://attack.mitre.org/software/S0366", "WannaCry", "WannaCry uses Tor for command and control traffic.[24]"]}, "Mitigation": {"M1037": ["https://attack.mitre.org/mitigations/M1037", "Filter Network Traffic", "Traffic to known anonymity networks and C2 infrastructure can be blocked through the use of network allow and block lists. It should be noted that this kind of blocking may be circumvented by other techniques like Domain Fronting."]}, "Detection": {"Network Connection Creation": ["Monitor for newly constructed network connections that are sent or received by untrusted hosts.", "DS0029", "https://attack.mitre.org/datasources/DS0029", "Network Traffic"], "Network Traffic Content": ["Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure). Consider correlation with process monitoring and command line to detect anomalous processes execution and command line arguments associated to traffic patterns (e.g. monitor anomalies in use of files that do not normally initiate connections for respective protocol(s)).", "", "", ""], "Network Traffic Flow": ["Monitor network data for uncommon data flows. Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.", "", "", ""]}}
